G.Layer.Graphic=G.Layer.Graphic.extend({_initContainer:function(){var e=this,t=e._map,i=G.DomUtil,o=e._container=i.create("div","g-layer");e._vml=i.createVML("group","",o),t._layersFrame.appendChild(o),i.setZIndex(o,e._zIndex)},_update:function(){var e=this;e.isVisible()?e._draw():e._erase()},_draw:function(){var e=this,t=e._map,i=G.DomUtil,o=t.getDrawSize(),r=o[0],a=o[1],n=e._vml;i.setZIndex(e._container,e._zIndex),i.show(n),n.style.width=r,n.style.height=a,n.coordsize=[r,a].join(" ");var l,s,_,d=t.getRedrawExtent();for(s in e._graphics)l=e._graphics[s],_=l.bbox,l._layer&&G.ExtentUtil.overlaps(_,d)?l._draw():l._erase()},_erase:function(){var e=this,t=e._vml;G.DomUtil.hide(t)},_onClear:function(){var e=this,t=e._vml;t&&(t.innerHTML="")}}),G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var e=this,t=e._map,i=G.DomUtil,o=e._container=i.create("div","g-layer"),r="g-tile-container g-zoom-animated";e._bg=i.create("div",r,e._container),e._front=i.create("div",r,e._container),t._layersFrame.appendChild(e._container),i.setZIndex(o,e._zIndex)},_destroyContainer:function(){var e=this;e._container.parentNode.removeChild(e._container),delete e._container},_update:function(){var e=this,t=e._map;if(t._isLoaded()){var i,o,r,a,n,l,s,_,d,p,c,m=e._zoom=e._calcNearestZoom(!0),u=e._calcVisTileInfos(!0),g=(t.getSize(),t.getCenter()),h=e.options,f=h.zoomReses[m],v=h.tileSize,y=t.getDrawSize(),x=y[0],L=y[1],D=g[0]-x*f/2,M=g[0]+x*f/2,C=g[1]-L*f/2,S=g[1]+L*f/2,V=[D,C,M,S],O=t.options.maxExtent;e._redrawExtent=V;var w=G.ExtentUtil.intersect(V,O);for(var E in e._tiles)r=e._tiles[E],a=r._info,i=a[0],o=a[1],n=a[2],c=h.zoomReses[n],n!==m&&(e._stopLoadingTile(r),(!h.keepResample||h.opacity<1)&&e._removeTile(E)),l=h.originX+i*v*c,s=h.originX+(i+1)*v*c,_=h.originY-(o+1)*v*c,d=h.originY-o*v*c,p=G.ExtentUtil.overlaps([l,_,s,d],w),p||e._tileInfoExist(a,u)||e._removeTile(E);e._placeLoadedTiles(e._bg),e._placeLoadedTiles(e._front);var N=e._calcTileIndex(g[0],g[1],m);e._sortTileInfos(u,N[0],N[1]),e._addTiles(u)}},_draw:function(){var e=this,t=e._map,i=G.DomUtil;t._isLoaded()&&(i.show(e._bg),i.show(e._front),i.setZIndex(e._container,e._zIndex),e._placeLoadedTiles(e._bg),e._placeLoadedTiles(e._front))},_erase:function(){var e=this,t=G.DomUtil;t.hide(e._bg),t.hide(e._front)},_onZoomEnd:function(){var e=this,t=e._front,i=e._bg,o=G.DomUtil,r=o.Transition,a=o.Transform;t.parentNode.appendChild(t),t.style[a]="",t.style[r]="",i.style[a]="",i.style[r]="",e._zooming=!1},_clearBgBuffer:function(){var e=this,t=e._map;t&&!t._zooming&&(e._bg.innerHTML="")},_prepareBgBuffer:function(){var e=this,t=e._front,i=e._bg;e._stopLoadingTiles(i),e._front=i,e._bg=t},_placeLoadedTiles:function(e){for(var t,i,o,r,a,n,l=this,s=l.options,_=s.zoomReses.length,d=l._calcNearestZoom(!0),p=e.getElementsByTagName("img"),c=0,m=p.length;c<m;c++)t=p[c],t&&t.complete&&(i=t._info,o=parseInt(i[0]),r=parseInt(i[1]),a=parseInt(i[2]),n=a==d?_+1:a,l._placeTile(t,o,r,a,n))},_addTiles:function(e){var t=this;if(0!==e.length){t._numLoad=e.length,t._numLoadSuccess=0,t._numLoadError=0;for(var i,o,r,a,n,l,s,_=t.options,d=_.zoomReses.length,p=t.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,c=0,m=e.length;c<m;c++){if(o=e[c],r=o[0],a=o[1],n=o[2],s=_.zoomReses[n],l=t._getTileName(r,a,n),i=t._tiles[l],i?i.src==p?+new Date-i._responseTime>_.tileLiveMs&&t._loadTile(i,r,a,n):t._numLoadSuccess++:(i=t._getIdleTile(),t._tiles[l]=i,t._loadTile(i,r,a,n)),i.parentNode!==t._front&&(t._front.appendChild(i),i._wraps))for(var u in i._wraps){var g=i._wraps[u];g&&g.parentNode!==t._front&&t._front.appendChild(g)}t._placeTile(i,r,a,n,d)}t._checkAllHandled()}},_onNewWrapTile:function(e,t){var i=this,o=e._wraps[t];o&&o.parentNode!==i._front&&i._front.appendChild(o)}}),G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(e,t){var i=this;G.Layer.Graphic.prototype.init.call(i,t),i.url=e,i.options=G.Util.merge({},i.options,t),i._lts={},i._gx=i._gy=10},_initContainer:function(){var e=this;G.Layer.Graphic.prototype._initContainer.call(e)},_onAdded:function(){var e=this;e._container||e._initContainer()},_onRemoved:function(){var e=this;e._container&&e._destroyContainer()},_update:function(){var e=this,t=e._map;if(G.Layer.Graphic.prototype._update.call(e),t._isLoaded()){var i=e._zoom=e._calcNearestZoom(!0),o=t.getCenter();e._clearGrids();var r=t._zoomAnim;if(r&&r._playing);else{var a=e._calcVisTileInfos(),n=e._calcTileIndex(o[0],o[1],i);e._sortTileInfos(a,n[0],n[1]),e._setLts(a)}}},_setLts:function(e){var t=this;if(e.length){for(var i,o,r,a,n,l,s=[],_=0,d=e.length;_<d;_++)r=e[_],a=r[0],n=r[1],l=r[2],i=t._getTileName(a,n,l),s.push(i),i in t._lts?(o=t._lts[i],o.loading||o.data||o.ri||t._loadLtI(a,n,l)):t._loadLtI(a,n,l),t._placeLt(i);t._dirtyTileKeys=t._dirtyTileKeys||[];for(i in t._lts)s.indexOf(i)>-1||(t._stopLoadingLt(i),t._dirtyTileKeys.push(i))}},_checkDirtyTiles:function(){var e,t=this,i=t._dirtyTileKeys;if(i&&i.length>0)for(var o=0,r=i.length;o<r;o++)e=i[o],t._removeLt(e);t._dirtyTileKeys=[]},_placeLt:function(e){var t=this,i=t._lts[e];if(i&&i._info&&i.data){var o,r,a,n,l,s,_,d,p,c,m,u,g,h,f,v,y,x,L,D,M=i.data.l;for(o in M){r=M[o],a=Number(r[0]),n=Number(r[1]),l=Number(r[2]),s=Number(r[3]),_=Number(r[4]),d=Number(r[5]),p=r[6],v=[a,n],y="imgs"+o,x=i[y];for(L in x)c=x[L],m=c[0],u=c[1],g=c[2],h=c[3],f=c[4],D=c[5],D||(c[5]=D=new G.Graphic.Point(v,null,{shape:"image",size:[u,g],offset:[h,f],image:m,imageGravity:!!p}),D.addTo(t))}}},_removeLt:function(e){var t=this,i=t._lts[e];if(i&&i._info&&i.data){t._stopLoadingLt(e);var o,r,a,n,l,s=i.data.l;for(o in s){a="imgs"+o,n=i[a];for(l in n)r=n[l],g=r[5],g&&g.remove()}delete t._lts[e]}},_loadLtI:function(e,t,i){var o=this,r=o._getTileName(e,t,i),a=o._lts[r]=o._lts[r]||{};if(a._info=[e,t,i],""!==a.data){a.loading=!0;var n=o._getTileUrl(e,t,i,{d:"i",i:G.Browser.retina?"@2x":""}),l={};o.options.crossOrigin&&(l.crossOrigin=o.options.crossOrigin);var s={responseType:"http"===n.slice(0,4).toLowerCase()?"JSONP":"JSON",header:l,success:function(e,t){a.data=t,o._processLt(r)},error:function(e){404==e.status&&(a.data="")},complete:function(){delete a.ri,a.loading=!1}};o.options.crossOrigin&&(s.responseType="JSON");var _=G.Util.ajax(n,s);a.ri=_}},_processLt:function(e){var t=this,i=t._lts[e],o=i.data;if(o){var r,a,n,l,s,_,d,p,c,m,u,g,h,f,v,y,G,x,L,D,M,C=o.l,S=o.b,V=o.i,O=o.bb,w=t.options.icons||"";for(a in C){if(r=C[a],n=Number(r[0]),l=Number(r[1]),s=r[6],S&&a in S)for(h=S[a],D=0,M=h.length;D<M;D++)f=h[D],_=f[0],d=f[1],p=f[2],c=f[3],m=f[4],u=f[5],0!=u&&O&&(G=O.slice(m,m+u),x="data:image/png;base64,"+G,L="b"+D,i["imgs"+a]=i["imgs"+a]||{},i["imgs"+a][L]=[x,_,d,p,c]);if(V&&a in V)for(v=V[a],D=0,M=v.length;D<M;D++)y=v[D],_=y[0],d=y[1],p=y[2],c=y[3],g=y[4],x=w+g,L="i"+D,i["imgs"+a]=i["imgs"+a]||{},i["imgs"+a][L]=[x,_,d,p,c]}t._checkDirtyTiles(),t._placeLt(e)}},_stopLoadingLt:function(e){var t=this._lts[e],i=G.Util.ajaxCancel;t&&(i(t.ri),t.loading=!1)},_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(e,t,i,o){for(var r,a=this,n=e;n<=i;n++)for(var l=t;l<=o;l++)if(r=n+","+l,a._g[r])return!0;return!1},_markGrids:function(e,t,i,o){for(var r,a=this,n=e;n<=i;n++)for(var l=t;l<=o;l++)r=n+","+l,a._g[r]=!0}}),G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1e3},init:function(e,t){var i=this;G.Layer.Graphic.prototype.init.call(i,t),i.options=G.Util.merge({},i.options,t),i._reqFunc=e,i._loadingKeys={}},onSuccess:function(e){var t=this;"tile"==t.options.mode?t.fireEvent("loadTileSuccess",{extent:e}):t.fireEvent("loadAllSuccess")},onError:function(e){var t=this;"tile"==t.options.mode?t.fireEvent("loadTileError",{extent:e}):t.fireEvent("loadAllError")},onComplete:function(e){var t=this;if("tile"==t.options.mode){var i=e.join(",");delete t._loadingKeys[i],t.fireEvent("loadTileComplete",{extent:e})}else t.fireEvent("loadAllComplete")},_update:function(){var e=this,t=e._map;if(G.Layer.Graphic.prototype._update.call(e),t._isLoaded())if("tile"==e.options.mode){var i=e.count();i>e.options.vacuumCount&&e._vacuum();var o=e._calcVisTileInfos();e._addFts(o)}else e._loadAll()},_addFts:function(e){var t=this;if(0!==e.length){var i,o,r,a,n,l,s,_,d,p=t._loadingKeys,c={};for(i=0,o=e.length;i<o;i++)n=e[i],l=n[0],s=n[1],_=n[2],d=t._calcTileExtent(l,s,_),r=d.join(","),c[r]=d;for(r in p)c[r]||(a=p[r],G.Util.ajaxCancel(a),delete p[r]);for(r in c)d=c[r],t._loadFt(d)}},_loadFt:function(e){var t=this,i=e.join(","),o=t._reqFunc;if(!(i in t._loadingKeys)&&o){var r=o.call(t,e);t._loadingKeys[i]=r,t.fireEvent("loadTileStart",{extent:e})}},_loadAll:function(){var e=this,t="all",i=e._reqFunc;if(!(t in e._loadingKeys)&&i){var o=i.call(e);e._loadingKeys[t]=o,e.fireEvent("loadAllStart")}}}),G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1e3},init:function(e,t){var i=this,o=function(t){var o=e+"/query",r=i.options,a={ak:r.apiKey,where:r.where,outFields:r.outFields,limit:r.limit};t&&(a.geometry=JSON.stringify(t));var n={responseType:"http"===o.slice(0,4).toLowerCase()?"JSONP":"JSON",data:a,success:function(e,o){var a=o.data,n=a.geometryType,l=a.features;if(l){var s,_,d,p,c,m,u,g,h=l.length-1,f=Math.max(0,h-r.limit),v=[];for(s=h;s>=f;s--){_=l[s],d=_.id,p=_.geom,c=_.attrs||{},"Point"==n?v.push(new G.Graphic.Point(p,c)):"Polyline"==n?v.push(new G.Graphic.Polyline(p,c)):"Polygon"==n?v.push(new G.Graphic.Polygon(p,c)):"MultiPoint"==n?v.push(new G.Graphic.MultiPoint(p,c)):"MultiPolyline"==n?v.push(new G.Graphic.MultiPolyline(p,c)):"MultiPolygon"==n&&v.push(new G.Graphic.MultiPolygon(p,c));for(u in v)g=v[u],g&&(m=d+"_"+u,i.get(m)||g.addTo(i,m))}}i.onSuccess(t)},error:function(){i.onError(t)},complete:function(){i.onComplete(t)}};G.Util.ajax(o,n)};G.Layer.FeatureService.prototype.init.call(i,o,t)}}),G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(e,t){var i=this;G.Layer.Graphic.prototype.init.call(i,t),i.url=e},onSuccess:function(e){this.fireEvent("extentSuccess",{extent:e})},onError:function(e){this.fireEvent("extentError",{extent:e})},onComplete:function(e){var t=this;t.fireEvent("extentComplete",{extent:e})},_update:function(){var e=this,t=e._map,i=e._loadRes=t._res,o=e._loadExtent=t.getExtent(),r=e._loadedStatus;if((!r||i!=r[0]||!G.ExtentUtil.equals(o,r[1]))&&(G.Layer.Graphic.prototype._update.call(e),t._isLoaded())){var a=e._req;a&&G.Util.ajaxCancel(a);var n,l,s=e._graphics;for(l in s)n=s[l],n._dirty=!0;e._loadStep(1)}},_loadStep:function(e){var t=this,i=t.options,o=t._loadRes,r=t._loadExtent,a=i.tolerance*Math.pow(i.stepFactor,i.stepCount-e),n=t.url+"/filter",l={responseType:"JSON",data:{extent:JSON.stringify(r),excludeExtents:JSON.stringify([]),res:o,cellPixel:a,outFields:i.outFields},success:function(i,o){t._processResult(e,o)},complete:function(){t._req=null}};t._req=G.Util.ajax(n,l)},_processResult:function(e,t){var i=this,o=i.options,r=i._loadRes,a=i._loadExtent,n=o.tolerance*Math.pow(o.stepFactor,o.stepCount-e),l=r*n,s=t.geometryType,_=t.features;if(!_)return i.onError(a),void i.onComplete(a);var d,p,c,m,u,g,h,f,v=_.length-1;for(d=v;d>=0;d--)if(p=_[d],c=p.id,m=p.geom,u=p.attrs||{},"Point"==s)f=new G.Graphic.Point(m,u),i._updateGraphic(l,c,0,f);else if("Polyline"==s)f=new G.Graphic.Polyline(m,u),i._updateGraphic(l,c,0,f);else if("Polygon"==s)f=new G.Graphic.Polygon(m,u),i._updateGraphic(l,c,0,f);else if("MultiPoint"==s)for(g in m.multi)h=m.multi[g],f=new G.Graphic.Point(h,u),i._updateGraphic(l,c,g,f);else if("MultiPolyline"==s)for(g in m.multi)h=m.multi[g],f=new G.Graphic.Polyline(h,u),i._updateGraphic(l,c,g,f);else if("MultiPolygon"==s)for(g in m.multi)h=m.multi[g],f=new G.Graphic.Polygon(h,u),i._updateGraphic(l,c,g,f);e<o.stepCount?i._loadStep(e+1):(i._clearDirty(),i._loadedStatus=[r,a],i.onSuccess(a),i.onComplete(a))},_updateGraphic:function(e,t,i,o){var r=this,a=t+(i?"_"+i:""),n=r.get(a);n?(e<n._res&&(n.updateGeom(o.geom,!0),n._res=e),n._dirty=!1):(o._res=e,o.addTo(r,a))},_clearDirty:function(){var e,t,i=this,o=i._graphics;for(t in o)e=o[t],e._dirty&&e.remove()}}),G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(e,t){var i=this;i.options=G.Util.merge({},i.options,t),i._reqFunc=e,i._loadingKeys={},i._loadedKeys={}},onSuccess:function(e,t){var i=this;i._numLoadSuccess++;var o=parseInt(e[0]),r=parseInt(e[1]),a=parseInt(e[2]),n=i._getTileName(o,r,a);i._loadedKeys[n]=e,i.fireEvent("loadTileSuccess",{tileInfo:e,data:t})},onError:function(e){var t=this;t._numLoadError++,t.fireEvent("loadTileError",{tileInfo:e})},onComplete:function(e){var t=this,i=parseInt(e[0]),o=parseInt(e[1]),r=parseInt(e[2]),a=t._getTileName(i,o,r);delete t._loadingKeys[a],t.fireEvent("loadTileComplete",{tileInfo:e}),t._checkAllHandled()},_update:function(){var e=this,t=e._map;if(t._isLoaded()){var i,o,r,a,n,l,s,_=e._calcVisTileInfos(),d={};for(i=0,o=_.length;i<o;i++)a=_[i],n=a[0],l=a[1],s=a[2],r=e._getTileName(n,l,s),d[r]=a;e._addTiles(d);for(r in e._loadedKeys)d[r]||(a=e._loadedKeys[r],delete e._loadedKeys[r],e.fireEvent("unusedTile",{tileInfo:a}));e._onUpdated()}},_addTiles:function(e){var t,i,o,r=this,a=r._loadingKeys;for(t in a)e[t]||(i=a[t],G.Util.ajaxCancel(i),delete a[t]);r._numLoad=Object.keys(e).length,r._numLoadSuccess=0,r._numLoadError=0;for(t in e)o=e[t],r._loadTile(o);r._checkAllHandled()},_loadTile:function(e){var t=this,i=t._reqFunc,o=parseInt(e[0]),r=parseInt(e[1]),a=parseInt(e[2]),n=t._getTileName(o,r,a);if(!(n in t._loadingKeys)&&i){if(n in t._loadedKeys)return void t._numLoadSuccess++;var l=i.call(t,o,r,a);t._loadingKeys[n]=l,t.fireEvent("loadTileStart",{tileInfo:e})}},_stopLoadingByKey:function(e){var t=this._loadingKeys,i=t[e];i&&(G.Util.ajaxCancel(i),delete t[e])},_checkAllHandled:function(){var e=this;e._numLoad==e._numLoadSuccess+e._numLoadError&&e.fireEvent("allLoaded")},_onUpdated:function(){}}),G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._polygons={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map;if(e._updateGeomDraw(o._res),e._geomDraw){var r=e._layer._vml;e._dom&&r&&!e._dom.parentNode&&r.appendChild(e._dom);for(var a=Math.round,n=t.getPosition(o._mapFrame),l=e._geomDraw,s=(l.length,e.bbox),_=(s[0]+s[2])/2,d=(s[1]+s[3])/2,p=o._calcWrapPointRange([_,d])||[0,0],c=o.options.maxExtent,m=c[2]-c[0],u=p[0];u<=p[1];u++){var g=e._polygons[u];g||(g=e._polygons[u]=t.createVML("shape","g-vml"),g._path=t.createVML("path","g-vml",g),g._graphic=e,e._dom.appendChild(g));for(var h,f,v,y,x,L="",D=0,M=l.length;D<M;D++){h=l[D],f="";for(var C=0,S=h.length;C<S;C++)v=o.toScreen([h[C][0]+u*m,h[C][1]]),y=v[0]-n[0],x=v[1]-n[1],f+=0===C?" M ":"",f+=1===C?" L ":" ",f+=a(y)+","+a(x);f+=" X",L+=f}L+=" E",g._path.v=L,g.style.width=g.style.height=1,g.coordsize="1 1"}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=(e._layer,[]),r=0;r<i.outlineDashArray.length;r++)o[r]=parseInt(i.outlineDashArray[r]/i.outlineWidth);for(var r in e._polygons){var a=e._polygons[r];if(i.outline||e._mouseOver||e._editing?t.strokeVML(a,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:o.join(" "),endcap:i.outlineCap?i.outlineCap.replace("butt","flat"):"",joinstyle:i.outlineJoin,weight:(i.outline?i.outlineWidth:0)+(e._mouseOver?i.lineHighlightWiden:0),opacity:i.outlineOpacity}):t.strokeVML(a,{opacity:0}),i.fill){var n=G.Browser.getImageSrc(i.fillImage);t.fillVML(a,{color:i.fillColor,opacity:i.fillOpacity,src:n,type:i.fillImage?"tile":"solid"})}else t.fillVML(a,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._circles={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map;if(e.geom){var r=e._layer._vml;e._dom&&r&&!e._dom.parentNode&&r.appendChild(e._dom);for(var a=t.getPosition(o._mapFrame),n=o._res,l=e.geom[0],s=e.geom[1],_=e.geom[2],d=o._calcWrapPointRange(e.geom)||[0,0],p=o.options.maxExtent,c=p[2]-p[0],m=d[0];m<=d[1];m++){var u=e._circles[m];u||(u=e._circles[m]=t.createVML("oval","g-vml"),u._graphic=e,e._dom.appendChild(u));var g=o.toScreen([l+m*c,s]),h=g[0]-a[0],f=g[1]-a[1],v=_/n,y=u.style;y.width=y.height=2*v,y.left=h-v,y.top=f-v}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=(e._layer,[]),r=0;r<i.outlineDashArray.length;r++)o[r]=parseInt(i.outlineDashArray[r]/i.outlineWidth);for(var r in e._circles){var a=e._circles[r];if(i.outline||e._mouseOver||e._editing?t.strokeVML(a,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:o.join(" "),weight:(i.outline?i.outlineWidth:0)+(e._mouseOver?i.lineHighlightWiden:0),opacity:i.outlineOpacity}):t.strokeVML(a,{opacity:0}),i.fill){var n=G.Browser.getImageSrc(i.fillImage);t.fillVML(a,{color:i.fillColor,opacity:i.fillOpacity,color2:i.fillColor,src:n,focusposition:"50%, 50%",type:i.fillImage?"tile":i.gradual?"gradientradial":"solid"})}else t.fillVML(a,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Group=G.Graphic.Group.extend({_updateStyles:function(){var e,t,i,o=this,r=o._graphics;if(r&&r.length)for(e=0,t=r.length;e<t;e++)i=r[e],i._updateStyles&&i._updateStyles()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.MultiPoint=G.Graphic.MultiPoint.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._pointss={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=e.options,o=e._layer,r=o._map,a=e.geom;if(a&&a.m){var n=e._layer._vml;e._dom&&n&&!e._dom.parentNode&&n.appendChild(e._dom);var l=(t.getPosition(r._mapFrame),i.shape),s=i.size,_=s[0],d=s[1],p=i.offset,c=i.imageRotate;i.imageGravity&&(c+=r._rotate),"image"==l&&c&&(p=G.MathUtil.rotateVector(p,c));for(var m,u,g,h=a.m,f=e.bbox,v=(f[0]+f[2])/2,y=(f[1]+f[3])/2,x=r._calcWrapPointRange([v,y])||[0,0],L=r.options.maxExtent,D=L[2]-L[0],M=x[0];M<=x[1];M++)for(var C=e._pointss[M]=e._pointss[M]||[],S=0;S<h.length;S++){m=h[S],u=m[0],g=m[1];var V=C[S];V||(V="rect"==l?e._pointss[M][S]=t.createVML("rect","g-vml"):"image"==l?e._pointss[M][S]=t.createVML("image","g-vml"):"text"==l?e._pointss[M][S]=t.createVML("text","g-vml"):e._pointss[M][S]=t.createVML("oval","g-vml"),V._graphic=e,e._dom.appendChild(V));var O=r.toScreen([u+M*D,g]),w=O[0],E=O[1],N=w+p[0],W=E+p[1],T=V.style;if("circle"==l)T.left=N-_/2,T.top=W-_/2,T.width=T.height=_;else if("rect"==l)T.left=N-_/2,T.top=W-d/2,T.width=_,T.height=d;else if("image"==l){if(T.left=N,T.top=W,T.width=_,T.height=d,c){T.rotation=c;var U=[_/2,d/2],b=G.MathUtil.rotateVector(U,c);T.left=N-(U[0]-b[0]),T.top=W-(U[1]-b[1])}var I=G.Browser.getImageSrc(i.image);V.src=I}else if("text"==l){var P=i.text;if(!e._textMeasureWidth||e._textMeasure!=P){var F=t.create("div","",document.body);F.style.position="absolute",F.style.visibility="hidden",F.style.width=F.style.height="auto",F.style.fontFamily=i.textFont,F.style.fontStyle="italic"==i.textStyle?"italic":"normal",F.style.fontWeight="bold"==i.textStyle?"bold":"normal",F.style.fontSize=_+"px",F.innerHTML=P,e._textMeasureWidth=F.clientWidth+4,F.parentNode.removeChild(F),e._textMeasure=P}var R,k=_,A=e._textMeasureWidth,z=i.textAlign;R="left"==z?0:"right"==z?-A:-A/2,T.left=N+R,T.top=W-k/2,T.width=A,T.height=k,T.fontFamily=i.textFont,T.fontStyle="italic"==i.textStyle?"italic":"normal",T.fontWeight="bold"==i.textStyle?"bold":"normal",T.fontSize=_+"px",T.color=i.fillColor,T.filter="alpha(opacity="+100*i.fillOpacity+")",V.innerHTML=i.text}}e._updateStyles()}},_updateStyles:function(){var e=this,t=G.DomUtil,i=e.options;e._layer;for(var o in e._pointss){var r=e._pointss[o];for(var a in r){var n=r[a];if((i.outline||e._mouseOver||e._editing)&&"text"!=i.shape){var l,s=[];for(l=0;l<i.outlineDashArray.length;l++)s[l]=parseInt(i.outlineDashArray[l]/i.outlineWidth);t.strokeVML(n,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:s.join(" "),weight:e._mouseOver?i.outlineWidth+i.lineHighlightWiden:i.outlineWidth,opacity:i.outlineOpacity})}else t.strokeVML(n,{opacity:0});if(i.fill){var _=G.Browser.getImageSrc(i.fillImage);t.fillVML(n,{color:i.fillColor,opacity:i.fillOpacity,color2:i.fillColor,src:_,focusposition:"50%, 50%",type:i.fillImage?"tile":i.gradual?"gradientradial":"solid"})}else t.fillVML(n,{opacity:0})}}},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer;if(t){var i=t._map,o=G.DomUtil,r=i._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,e._updateStyles(),e._isVertex?o.addClass(i._layersFrame,"g-edit"):o.addClass(i._layersFrame,"g-clickable")}},_onMouseOut:function(){var e=this,t=e._layer;if(t){var i=t._map,o=G.DomUtil,r=i._handlers.Drag;r&&!r._dragging,e._updateStyles(),e._isVertex?o.removeClass(i._layersFrame,"g-edit"):o.removeClass(i._layersFrame,"g-clickable")}}}),G.Graphic.MultiPolygon=G.Graphic.MultiPolygon.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._polygonss={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map,r=e.geom;if(r&&r.m){var a=e._layer._vml;e._dom&&a&&!e._dom.parentNode&&a.appendChild(e._dom);for(var n=Math.round,l=t.getPosition(o._mapFrame),s=r.m,_=e.bbox,d=(_[0]+_[2])/2,p=(_[1]+_[3])/2,c=o._calcWrapPointRange([d,p])||[0,0],m=o.options.maxExtent,u=m[2]-m[0],g=c[0];g<=c[1];g++)for(var h=(e._polygonss[g]=e._polygonss[g]||[],0);h<s.length;h++){var f=e._polygonss[g][h];f||(f=e._polygonss[g][h]=t.createVML("shape","g-vml"),f._path=t.createVML("path","g-vml",f),f._graphic=e,e._dom.appendChild(f));for(var v,y,x,L,D,M="",C=s[h],S=0,V=C.length;S<V;S++){v=C[S],y="";for(var O=0,w=v.length;O<w;O++)x=o.toScreen([v[O][0]+g*u,v[O][1]]),L=x[0]-l[0],D=x[1]-l[1],y+=0===O?" M ":"",y+=1===O?" L ":" ",y+=n(L)+","+n(D);y+=" X",M+=y}M+=" E",f._path.v=M,f.style.width=f.style.height=1,f.coordsize="1 1"}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=(e._layer,[]),r=0;r<i.outlineDashArray.length;r++)o[r]=parseInt(i.outlineDashArray[r]/i.outlineWidth);for(var a in e._polygonss){var n=e._polygonss[a];for(var l in n){var s=n[l];if(i.outline||e._mouseOver||e._editing?t.strokeVML(s,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:o.join(" "),endcap:i.outlineCap?i.outlineCap.replace("butt","flat"):"",joinstyle:i.outlineJoin,weight:(i.outline?i.outlineWidth:0)+(e._mouseOver?i.lineHighlightWiden:0),opacity:i.outlineOpacity}):t.strokeVML(s,{opacity:0}),i.fill){var _=G.Browser.getImageSrc(i.fillImage);t.fillVML(s,{color:i.fillColor,opacity:i.fillOpacity,src:_,type:i.fillImage?"tile":"solid"})}else t.fillVML(s,{opacity:0})}}},_updateMask:function(){},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.MultiPolyline=G.Graphic.MultiPolyline.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._polyliness={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map,r=e.geom;if(r&&r.m){var a=e._layer._vml;e._dom&&a&&!e._dom.parentNode&&a.appendChild(e._dom);for(var n=Math.round,l=t.getPosition(o._mapFrame),s=r.m,_=e.bbox,d=(_[0]+_[2])/2,p=(_[1]+_[3])/2,c=o._calcWrapPointRange([d,p])||[0,0],m=o.options.maxExtent,u=m[2]-m[0],g=c[0];g<=c[1];g++)for(var h=(e._polyliness[g]=e._polyliness[g]||[],0);h<s.length;h++){var f=e._polyliness[g][h];f||(f=e._polyliness[g][h]=t.createVML("shape","g-vml"),f._path=t.createVML("path","g-vml",f),f._graphic=e,e._dom.appendChild(f));for(var v,y,x,L="",D=s[h],M=0,C=D.length;M<C;M++)v=o.toScreen([D[M][0]+g*u,D[M][1]]),y=v[0]-l[0],x=v[1]-l[1],L+=0===M?" M ":"",L+=1===M?" L ":" ",L+=n(y)+","+n(x);L+=" E",f._path.v=L,f.filled="f",f.style.width=f.style.height=1,f.coordsize="1 1"}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=[],r=0;r<i.lineDashArray.length;r++)o[r]=parseInt(i.lineDashArray[r]/i.lineWidth);for(var a in e._polyliness){var n=e._polyliness[a];for(var l in n){var s=n[l];t.strokeVML(s,{color:e._editing?i.lineHighlightColor:i.lineColor,dashstyle:o.join(" "),endcap:i.lineCap?i.lineCap.replace("butt","flat"):"",joinstyle:i.lineJoin,weight:e._mouseOver?i.lineWidth+i.lineHighlightWiden:i.lineWidth,opacity:i.lineOpacity})}}},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._points={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=e.options,o=e._layer,r=o._map;if(e.geom){var a=e._layer._vml;e._dom&&a&&!e._dom.parentNode&&a.appendChild(e._dom);var n=(t.getPosition(r._mapFrame),i.shape),l=i.size,s=l[0],_=l[1],d=i.offset,p=i.imageRotate;i.imageGravity&&(p+=r._rotate),"image"==n&&p&&(d=G.MathUtil.rotateVector(d,p));for(var c=e.geom[0],m=e.geom[1],u=r._calcWrapPointRange(e.geom)||[0,0],g=r.options.maxExtent,h=g[2]-g[0],f=u[0];f<=u[1];f++){var v=e._points[f];v||(v="rect"==n?e._points[f]=t.createVML("rect","g-vml"):"image"==n?e._points[f]=t.createVML("image","g-vml"):"text"==n?e._points[f]=t.createVML("text","g-vml"):e._points[f]=t.createVML("oval","g-vml"),v._graphic=e,e._dom.appendChild(v));var y=r.toScreen([c+f*h,m]),x=y[0],L=y[1],D=x+d[0],M=L+d[1],C=v.style;if("circle"==n)C.left=D-s/2,C.top=M-s/2,C.width=C.height=s;else if("rect"==n)C.left=D-s/2,C.top=M-_/2,C.width=s,C.height=_;else if("image"==n){if(C.left=D,C.top=M,C.width=s,C.height=_,p){C.rotation=p;var S=[s/2,_/2],V=G.MathUtil.rotateVector(S,p);C.left=D-(S[0]-V[0]),C.top=M-(S[1]-V[1])}var O=G.Browser.getImageSrc(i.image);v.src=O}else if("text"==n){var w=i.text;if(!e._textMeasureWidth||e._textMeasure!=w){var E=t.create("div","",document.body);E.style.position="absolute",E.style.visibility="hidden",E.style.width=E.style.height="auto",E.style.fontFamily=i.textFont,E.style.fontStyle="italic"==i.textStyle?"italic":"normal",E.style.fontWeight="bold"==i.textStyle?"bold":"normal",E.style.fontSize=s+"px",E.innerHTML=w,e._textMeasureWidth=E.clientWidth+4,E.parentNode.removeChild(E),e._textMeasure=w}var N,W=s,T=e._textMeasureWidth,U=i.textAlign;N="left"==U?0:"right"==U?-T:-T/2,C.left=D+N,C.top=M-W/2,C.width=T,C.height=W,C.fontFamily=i.textFont,C.fontStyle="italic"==i.textStyle?"italic":"normal",C.fontWeight="bold"==i.textStyle?"bold":"normal",C.fontSize=s+"px",C.color=i.fillColor,C.filter="alpha(opacity="+100*i.fillOpacity+")",v.innerHTML=i.text}}e._updateStyles()}},_updateStyles:function(){var e=this,t=G.DomUtil,i=e.options;e._layer;for(var o in e._points){var r=e._points[o];if((i.outline||e._mouseOver||e._editing)&&"text"!=i.shape){var o,a=[];for(o=0;o<i.outlineDashArray.length;o++)a[o]=parseInt(i.outlineDashArray[o]/i.outlineWidth);t.strokeVML(r,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:a.join(" "),weight:e._mouseOver?i.outlineWidth+i.lineHighlightWiden:i.outlineWidth,opacity:i.outlineOpacity})}else t.strokeVML(r,{opacity:0});if(i.fill){var n=G.Browser.getImageSrc(i.fillImage);t.fillVML(r,{color:i.fillColor,opacity:i.fillOpacity,color2:i.fillColor,src:n,focusposition:"50%, 50%",type:i.fillImage?"tile":i.gradual?"gradientradial":"solid"})}else t.fillVML(r,{opacity:0})}},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],
o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer;if(t){var i=t._map,o=G.DomUtil,r=i._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,e._updateStyles(),e._isVertex?o.addClass(i._layersFrame,"g-edit"):o.addClass(i._layersFrame,"g-clickable")}},_onMouseOut:function(){var e=this,t=e._layer;if(t){var i=t._map,o=G.DomUtil,r=i._handlers.Drag;r&&!r._dragging,e._updateStyles(),e._isVertex?o.removeClass(i._layersFrame,"g-edit"):o.removeClass(i._layersFrame,"g-clickable")}}}),G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._polygons={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map;if(e.geom){var r=e._layer._vml;e._dom&&r&&!e._dom.parentNode&&r.appendChild(e._dom);for(var a=Math.round,n=t.getPosition(o._mapFrame),l=e.geom,s=(l.length,e.bbox),_=(s[0]+s[2])/2,d=(s[1]+s[3])/2,p=o._calcWrapPointRange([_,d])||[0,0],c=o.options.maxExtent,m=c[2]-c[0],u=p[0];u<=p[1];u++){var g=e._polygons[u];g||(g=e._polygons[u]=t.createVML("shape","g-vml"),g._path=t.createVML("path","g-vml",g),g._graphic=e,e._dom.appendChild(g));for(var h,f,v,y,x,L="",D=0,M=l.length;D<M;D++){h=l[D],f="";for(var C=0,S=h.length;C<S;C++)v=o.toScreen([h[C][0]+u*m,h[C][1]]),y=v[0]-n[0],x=v[1]-n[1],f+=0===C?" M ":"",f+=1===C?" L ":" ",f+=a(y)+","+a(x);f+=" X",L+=f}L+=" E",g._path.v=L,g.style.width=g.style.height=1,g.coordsize="1 1"}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=(e._layer,[]),r=0;r<i.outlineDashArray.length;r++)o[r]=parseInt(i.outlineDashArray[r]/i.outlineWidth);for(var r in e._polygons){var a=e._polygons[r];if(i.outline||e._mouseOver||e._editing?t.strokeVML(a,{color:e._editing?i.lineHighlightColor:i.outline?i.outlineColor:i.fillColor,dashstyle:o.join(" "),endcap:i.outlineCap?i.outlineCap.replace("butt","flat"):"",joinstyle:i.outlineJoin,weight:(i.outline?i.outlineWidth:0)+(e._mouseOver?i.lineHighlightWiden:0),opacity:i.outlineOpacity}):t.strokeVML(a,{opacity:0}),i.fill){var n=G.Browser.getImageSrc(i.fillImage);t.fillVML(a,{color:i.fillColor,opacity:i.fillOpacity,src:n,type:i.fillImage?"tile":"solid"})}else t.fillVML(a,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var e=this,t=G.DomUtil;e._dom||(e._dom=t.createVML("group","g-vml-container")),e._polylines={};var i=e._layer._map;i&&i._requestRedraw()},_onRemoved:function(){var e=this,t=e._dom;t&&t.parentNode&&t.parentNode.removeChild(t);var i=e._layer._map;i&&i._requestRedraw()},_draw:function(){var e=this,t=G.DomUtil,i=(e.options,e._layer),o=i._map;if(e.geom){var r=e._layer._vml;e._dom&&r&&!e._dom.parentNode&&r.appendChild(e._dom);for(var a=Math.round,n=t.getPosition(o._mapFrame),l=e.geom,s=l.length,_=e.bbox,d=(_[0]+_[2])/2,p=(_[1]+_[3])/2,c=o._calcWrapPointRange([d,p])||[0,0],m=o.options.maxExtent,u=m[2]-m[0],g=c[0];g<=c[1];g++){var h=e._polylines[g];h||(h=e._polylines[g]=t.createVML("shape","g-vml"),h._path=t.createVML("path","g-vml",h),h._graphic=e,e._dom.appendChild(h));for(var f,v,y,x="",L=0;L<s;L++)f=o.toScreen([l[L][0]+g*u,l[L][1]]),v=f[0]-n[0],y=f[1]-n[1],x+=0===L?" M ":"",x+=1===L?" L ":" ",x+=a(v)+","+a(y);x+=" E",h._path.v=x,h.filled="f",h.style.width=h.style.height=1,h.coordsize="1 1"}e._updateStyles()}},_updateStyles:function(){for(var e=this,t=G.DomUtil,i=e.options,o=[],r=0;r<i.lineDashArray.length;r++)o[r]=parseInt(i.lineDashArray[r]/i.lineWidth);for(var r in e._polylines){var a=e._polylines[r];t.strokeVML(a,{color:e._editing?i.lineHighlightColor:i.lineColor,dashstyle:o.join(" "),endcap:i.lineCap?i.lineCap.replace("butt","flat"):"",joinstyle:i.lineJoin,weight:e._mouseOver?i.lineWidth+i.lineHighlightWiden:i.lineWidth,opacity:i.lineOpacity})}},_onStartEdit:function(){var e=this,t=e._layer._map,o=e.virtualMouse;for(i in o.DOWN)t.addListener(o.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,i=this,o=i._layer._map,r=i.virtualMouse;for(e in r.DOWN)t=r.DOWN[e],o.removeListener(t,i._onVertexDragStart,i),o.removeListener(r.MOVE[t],i._onVertexDrag,i),o.removeListener(r.UP[t],i._onVertexDragEnd,i);i._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,i=t._handlers.Drag;i&&!i._dragging,e._updateStyles(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Map=G.Map.extend({_initAddition:function(){var e=this;e._mode="vml"}});