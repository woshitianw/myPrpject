!function(e){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!o)var o=Math.random;var n={};n.setMatrixArrayType=function(e){r=e},"undefined"!=typeof e&&(e.glMatrix=n);var i=Math.PI/180;n.toRadian=function(e){return e*i};var a={};a.create=function(){var e=new r(2);return e[0]=0,e[1]=0,e},a.clone=function(e){var t=new r(2);return t[0]=e[0],t[1]=e[1],t},a.fromValues=function(e,t){var o=new r(2);return o[0]=e,o[1]=t,o},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},a.set=function(e,t,r){return e[0]=t,e[1]=r,e},a.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},a.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},a.sub=a.subtract,a.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},a.mul=a.multiply,a.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},a.div=a.divide,a.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},a.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},a.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},a.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e},a.distance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(r*r+o*o)},a.dist=a.distance,a.squaredDistance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1];return r*r+o*o},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},a.len=a.length,a.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},a.normalize=function(e,t){var r=t[0],o=t[1],n=r*r+o*o;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},a.cross=function(e,t,r){var o=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=o,e},a.lerp=function(e,t,r,o){var n=t[0],i=t[1];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e},a.random=function(e,t){t=t||1;var r=2*o()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},a.transformMat2=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[2]*n,e[1]=r[1]*o+r[3]*n,e},a.transformMat2d=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[2]*n+r[4],e[1]=r[1]*o+r[3]*n+r[5],e},a.transformMat3=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[3]*n+r[6],e[1]=r[1]*o+r[4]*n+r[7],e},a.transformMat4=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[4]*n+r[12],e[1]=r[1]*o+r[5]*n+r[13],e},a.forEach=function(){var e=a.create();return function(t,r,o,n,i,a){var _,l;for(r||(r=2),o||(o=0),l=n?Math.min(n*r+o,t.length):t.length,_=o;_<l;_+=r)e[0]=t[_],e[1]=t[_+1],i(e,e,a),t[_]=e[0],t[_+1]=e[1];return t}}(),a.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!=typeof e&&(e.vec2=a);var _={};_.create=function(){var e=new r(3);return e[0]=0,e[1]=0,e[2]=0,e},_.clone=function(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},_.fromValues=function(e,t,o){var n=new r(3);return n[0]=e,n[1]=t,n[2]=o,n},_.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},_.set=function(e,t,r,o){return e[0]=t,e[1]=r,e[2]=o,e},_.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},_.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},_.sub=_.subtract,_.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},_.mul=_.multiply,_.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},_.div=_.divide,_.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},_.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},_.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},_.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e},_.distance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+o*o+n*n)},_.dist=_.distance,_.squaredDistance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2];return r*r+o*o+n*n},_.sqrDist=_.squaredDistance,_.length=function(e){var t=e[0],r=e[1],o=e[2];return Math.sqrt(t*t+r*r+o*o)},_.len=_.length,_.squaredLength=function(e){var t=e[0],r=e[1],o=e[2];return t*t+r*r+o*o},_.sqrLen=_.squaredLength,_.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},_.normalize=function(e,t){var r=t[0],o=t[1],n=t[2],i=r*r+o*o+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e},_.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},_.cross=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[0],_=r[1],l=r[2];return e[0]=n*l-i*_,e[1]=i*a-o*l,e[2]=o*_-n*a,e},_.lerp=function(e,t,r,o){var n=t[0],i=t[1],a=t[2];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e[2]=a+o*(r[2]-a),e},_.random=function(e,t){t=t||1;var r=2*o()*Math.PI,n=2*o()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},_.transformMat4=function(e,t,r){var o=t[0],n=t[1],i=t[2];return e[0]=r[0]*o+r[4]*n+r[8]*i+r[12],e[1]=r[1]*o+r[5]*n+r[9]*i+r[13],e[2]=r[2]*o+r[6]*n+r[10]*i+r[14],e},_.transformMat3=function(e,t,r){var o=t[0],n=t[1],i=t[2];return e[0]=o*r[0]+n*r[3]+i*r[6],e[1]=o*r[1]+n*r[4]+i*r[7],e[2]=o*r[2]+n*r[5]+i*r[8],e},_.transformQuat=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[0],_=r[1],l=r[2],s=r[3],u=s*o+_*i-l*n,f=s*n+l*o-a*i,c=s*i+a*n-_*o,g=-a*o-_*n-l*i;return e[0]=u*s+g*-a+f*-l-c*-_,e[1]=f*s+g*-_+c*-a-u*-l,e[2]=c*s+g*-l+u*-_-f*-a,e},_.rotateX=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[0],i[1]=n[1]*Math.cos(o)-n[2]*Math.sin(o),i[2]=n[1]*Math.sin(o)+n[2]*Math.cos(o),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},_.rotateY=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[2]*Math.sin(o)+n[0]*Math.cos(o),i[1]=n[1],i[2]=n[2]*Math.cos(o)-n[0]*Math.sin(o),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},_.rotateZ=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[0]*Math.cos(o)-n[1]*Math.sin(o),i[1]=n[0]*Math.sin(o)+n[1]*Math.cos(o),i[2]=n[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},_.forEach=function(){var e=_.create();return function(t,r,o,n,i,a){var _,l;for(r||(r=3),o||(o=0),l=n?Math.min(n*r+o,t.length):t.length,_=o;_<l;_+=r)e[0]=t[_],e[1]=t[_+1],e[2]=t[_+2],i(e,e,a),t[_]=e[0],t[_+1]=e[1],t[_+2]=e[2];return t}}(),_.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},"undefined"!=typeof e&&(e.vec3=_);var l={};l.create=function(){var e=new r(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},l.clone=function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},l.fromValues=function(e,t,o,n){var i=new r(4);return i[0]=e,i[1]=t,i[2]=o,i[3]=n,i},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.set=function(e,t,r,o,n){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e},l.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},l.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},l.sub=l.subtract,l.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},l.mul=l.multiply,l.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},l.div=l.divide,l.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},l.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},l.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},l.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e},l.distance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+o*o+n*n+i*i)},l.dist=l.distance,l.squaredDistance=function(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2],i=t[3]-e[3];return r*r+o*o+n*n+i*i},l.sqrDist=l.squaredDistance,l.length=function(e){var t=e[0],r=e[1],o=e[2],n=e[3];return Math.sqrt(t*t+r*r+o*o+n*n)},l.len=l.length,l.squaredLength=function(e){var t=e[0],r=e[1],o=e[2],n=e[3];return t*t+r*r+o*o+n*n},l.sqrLen=l.squaredLength,l.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},l.normalize=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*r+o*o+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a),e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.lerp=function(e,t,r,o){var n=t[0],i=t[1],a=t[2],_=t[3];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e[2]=a+o*(r[2]-a),e[3]=_+o*(r[3]-_),e},l.random=function(e,t){return t=t||1,e[0]=o(),e[1]=o(),e[2]=o(),e[3]=o(),l.normalize(e,e),l.scale(e,e,t),e},l.transformMat4=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3];return e[0]=r[0]*o+r[4]*n+r[8]*i+r[12]*a,e[1]=r[1]*o+r[5]*n+r[9]*i+r[13]*a,e[2]=r[2]*o+r[6]*n+r[10]*i+r[14]*a,e[3]=r[3]*o+r[7]*n+r[11]*i+r[15]*a,e},l.transformQuat=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[0],_=r[1],l=r[2],s=r[3],u=s*o+_*i-l*n,f=s*n+l*o-a*i,c=s*i+a*n-_*o,g=-a*o-_*n-l*i;return e[0]=u*s+g*-a+f*-l-c*-_,e[1]=f*s+g*-_+c*-a-u*-l,e[2]=c*s+g*-l+u*-_-f*-a,e},l.forEach=function(){var e=l.create();return function(t,r,o,n,i,a){var _,l;for(r||(r=4),o||(o=0),l=n?Math.min(n*r+o,t.length):t.length,_=o;_<l;_+=r)e[0]=t[_],e[1]=t[_+1],e[2]=t[_+2],e[3]=t[_+3],i(e,e,a),t[_]=e[0],t[_+1]=e[1],t[_+2]=e[2],t[_+3]=e[3];return t}}(),l.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.vec4=l);var s={};s.create=function(){var e=new r(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},s.clone=function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},s.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},s.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*i-n*o;return a?(a=1/a,e[0]=i*a,e[1]=-o*a,e[2]=-n*a,e[3]=r*a,e):null},s.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},s.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},s.multiply=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=r[0],l=r[1],s=r[2],u=r[3];return e[0]=o*_+i*l,e[1]=n*_+a*l,e[2]=o*s+i*u,e[3]=n*s+a*u,e},s.mul=s.multiply,s.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=Math.sin(r),l=Math.cos(r);return e[0]=o*l+i*_,e[1]=n*l+a*_,e[2]=o*-_+i*l,e[3]=n*-_+a*l,e},s.scale=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=r[0],l=r[1];return e[0]=o*_,e[1]=n*_,e[2]=i*l,e[3]=a*l,e},s.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},s.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},s.LDU=function(e,t,r,o){return e[2]=o[2]/o[0],r[0]=o[0],r[1]=o[1],r[3]=o[3]-e[2]*r[1],[e,t,r]},"undefined"!=typeof e&&(e.mat2=s);var u={};u.create=function(){var e=new r(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},u.clone=function(e){var t=new r(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},u.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},u.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=r*i-o*n;return l?(l=1/l,e[0]=i*l,e[1]=-o*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*_-i*a)*l,e[5]=(o*a-r*_)*l,e):null},u.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},u.multiply=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=r[0],u=r[1],f=r[2],c=r[3],g=r[4],h=r[5];return e[0]=o*s+i*u,e[1]=n*s+a*u,e[2]=o*f+i*c,e[3]=n*f+a*c,e[4]=o*g+i*h+_,e[5]=n*g+a*h+l,e},u.mul=u.multiply,u.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=Math.sin(r),u=Math.cos(r);return e[0]=o*u+i*s,e[1]=n*u+a*s,e[2]=o*-s+i*u,e[3]=n*-s+a*u,e[4]=_,e[5]=l,e},u.scale=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=r[0],u=r[1];return e[0]=o*s,e[1]=n*s,e[2]=i*u,e[3]=a*u,e[4]=_,e[5]=l,e},u.translate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=r[0],u=r[1];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=o*s+i*u+_,e[5]=n*s+a*u+l,e},u.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},u.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},"undefined"!=typeof e&&(e.mat2d=u);var f={};f.create=function(){var e=new r(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},f.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},f.clone=function(e){var t=new r(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},f.transpose=function(e,t){if(e===t){var r=t[1],o=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=o,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},f.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=t[6],s=t[7],u=t[8],f=u*a-_*s,c=-u*i+_*l,g=s*i-a*l,h=r*f+o*c+n*g;return h?(h=1/h,e[0]=f*h,e[1]=(-u*o+n*s)*h,e[2]=(_*o-n*a)*h,e[3]=c*h,e[4]=(u*r-n*l)*h,e[5]=(-_*r+n*i)*h,e[6]=g*h,e[7]=(-s*r+o*l)*h,e[8]=(a*r-o*i)*h,e):null},f.adjoint=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=t[6],s=t[7],u=t[8];return e[0]=a*u-_*s,e[1]=n*s-o*u,e[2]=o*_-n*a,e[3]=_*l-i*u,e[4]=r*u-n*l,e[5]=n*i-r*_,e[6]=i*s-a*l,e[7]=o*l-r*s,e[8]=r*a-o*i,e},f.determinant=function(e){var t=e[0],r=e[1],o=e[2],n=e[3],i=e[4],a=e[5],_=e[6],l=e[7],s=e[8];return t*(s*i-a*l)+r*(-s*n+a*_)+o*(l*n-i*_)},f.multiply=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=t[6],u=t[7],f=t[8],c=r[0],g=r[1],h=r[2],p=r[3],d=r[4],v=r[5],m=r[6],x=r[7],y=r[8];return e[0]=c*o+g*a+h*s,e[1]=c*n+g*_+h*u,e[2]=c*i+g*l+h*f,e[3]=p*o+d*a+v*s,e[4]=p*n+d*_+v*u,e[5]=p*i+d*l+v*f,e[6]=m*o+x*a+y*s,e[7]=m*n+x*_+y*u,e[8]=m*i+x*l+y*f,e},f.mul=f.multiply,f.translate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=t[6],u=t[7],f=t[8],c=r[0],g=r[1];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=_,e[5]=l,e[6]=c*o+g*a+s,e[7]=c*n+g*_+u,e[8]=c*i+g*l+f,e},f.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=t[6],u=t[7],f=t[8],c=Math.sin(r),g=Math.cos(r);return e[0]=g*o+c*a,e[1]=g*n+c*_,e[2]=g*i+c*l,e[3]=g*a-c*o,e[4]=g*_-c*n,e[5]=g*l-c*i,e[6]=s,e[7]=u,e[8]=f,e},f.scale=function(e,t,r){var o=r[0],n=r[1];return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},f.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},f.fromQuat=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r+r,_=o+o,l=n+n,s=r*a,u=o*a,f=o*_,c=n*a,g=n*_,h=n*l,p=i*a,d=i*_,v=i*l;return e[0]=1-f-h,e[3]=u-v,e[6]=c+d,e[1]=u+v,e[4]=1-s-h,e[7]=g-p,e[2]=c-d,e[5]=g+p,e[8]=1-s-f,e},f.normalFromMat4=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=t[6],s=t[7],u=t[8],f=t[9],c=t[10],g=t[11],h=t[12],p=t[13],d=t[14],v=t[15],m=r*_-o*a,x=r*l-n*a,y=r*s-i*a,E=o*l-n*_,w=o*s-i*_,G=n*s-i*l,L=u*p-f*h,R=u*d-c*h,b=u*v-g*h,C=f*d-c*p,z=f*v-g*p,T=c*v-g*d,U=m*T-x*z+y*C+E*b-w*R+G*L;return U?(U=1/U,e[0]=(_*T-l*z+s*C)*U,e[1]=(l*b-a*T-s*R)*U,e[2]=(a*z-_*b+s*L)*U,e[3]=(n*z-o*T-i*C)*U,e[4]=(r*T-n*b+i*R)*U,e[5]=(o*b-r*z-i*L)*U,e[6]=(p*G-d*w+v*E)*U,e[7]=(d*y-h*G-v*x)*U,e[8]=(h*w-p*y+v*m)*U,e):null},f.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},f.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},"undefined"!=typeof e&&(e.mat3=f);var c={};c.create=function(){var e=new r(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.clone=function(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var r=t[1],o=t[2],n=t[3],i=t[6],a=t[7],_=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=i,e[11]=t[14],e[12]=n,e[13]=a,e[14]=_}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=t[6],s=t[7],u=t[8],f=t[9],c=t[10],g=t[11],h=t[12],p=t[13],d=t[14],v=t[15],m=r*_-o*a,x=r*l-n*a,y=r*s-i*a,E=o*l-n*_,w=o*s-i*_,G=n*s-i*l,L=u*p-f*h,R=u*d-c*h,b=u*v-g*h,C=f*d-c*p,z=f*v-g*p,T=c*v-g*d,U=m*T-x*z+y*C+E*b-w*R+G*L;return U?(U=1/U,e[0]=(_*T-l*z+s*C)*U,e[1]=(n*z-o*T-i*C)*U,e[2]=(p*G-d*w+v*E)*U,e[3]=(c*w-f*G-g*E)*U,e[4]=(l*b-a*T-s*R)*U,e[5]=(r*T-n*b+i*R)*U,e[6]=(d*y-h*G-v*x)*U,e[7]=(u*G-c*y+g*x)*U,e[8]=(a*z-_*b+s*L)*U,e[9]=(o*b-r*z-i*L)*U,e[10]=(h*w-p*y+v*m)*U,e[11]=(f*y-u*w-g*m)*U,e[12]=(_*R-a*C-l*L)*U,e[13]=(r*C-o*R+n*L)*U,e[14]=(p*x-h*E-d*m)*U,e[15]=(u*E-f*x+c*m)*U,e):null},c.adjoint=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],_=t[5],l=t[6],s=t[7],u=t[8],f=t[9],c=t[10],g=t[11],h=t[12],p=t[13],d=t[14],v=t[15];return e[0]=_*(c*v-g*d)-f*(l*v-s*d)+p*(l*g-s*c),e[1]=-(o*(c*v-g*d)-f*(n*v-i*d)+p*(n*g-i*c)),e[2]=o*(l*v-s*d)-_*(n*v-i*d)+p*(n*s-i*l),e[3]=-(o*(l*g-s*c)-_*(n*g-i*c)+f*(n*s-i*l)),e[4]=-(a*(c*v-g*d)-u*(l*v-s*d)+h*(l*g-s*c)),e[5]=r*(c*v-g*d)-u*(n*v-i*d)+h*(n*g-i*c),e[6]=-(r*(l*v-s*d)-a*(n*v-i*d)+h*(n*s-i*l)),e[7]=r*(l*g-s*c)-a*(n*g-i*c)+u*(n*s-i*l),e[8]=a*(f*v-g*p)-u*(_*v-s*p)+h*(_*g-s*f),e[9]=-(r*(f*v-g*p)-u*(o*v-i*p)+h*(o*g-i*f)),e[10]=r*(_*v-s*p)-a*(o*v-i*p)+h*(o*s-i*_),e[11]=-(r*(_*g-s*f)-a*(o*g-i*f)+u*(o*s-i*_)),e[12]=-(a*(f*d-c*p)-u*(_*d-l*p)+h*(_*c-l*f)),e[13]=r*(f*d-c*p)-u*(o*d-n*p)+h*(o*c-n*f),e[14]=-(r*(_*d-l*p)-a*(o*d-n*p)+h*(o*l-n*_)),e[15]=r*(_*c-l*f)-a*(o*c-n*f)+u*(o*l-n*_),e},c.determinant=function(e){var t=e[0],r=e[1],o=e[2],n=e[3],i=e[4],a=e[5],_=e[6],l=e[7],s=e[8],u=e[9],f=e[10],c=e[11],g=e[12],h=e[13],p=e[14],d=e[15],v=t*a-r*i,m=t*_-o*i,x=t*l-n*i,y=r*_-o*a,E=r*l-n*a,w=o*l-n*_,G=s*h-u*g,L=s*p-f*g,R=s*d-c*g,b=u*p-f*h,C=u*d-c*h,z=f*d-c*p;return v*z-m*C+x*b+y*R-E*L+w*G},c.multiply=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=t[6],u=t[7],f=t[8],c=t[9],g=t[10],h=t[11],p=t[12],d=t[13],v=t[14],m=t[15],x=r[0],y=r[1],E=r[2],w=r[3];return e[0]=x*o+y*_+E*f+w*p,e[1]=x*n+y*l+E*c+w*d,e[2]=x*i+y*s+E*g+w*v,e[3]=x*a+y*u+E*h+w*m,x=r[4],y=r[5],E=r[6],w=r[7],e[4]=x*o+y*_+E*f+w*p,e[5]=x*n+y*l+E*c+w*d,e[6]=x*i+y*s+E*g+w*v,e[7]=x*a+y*u+E*h+w*m,x=r[8],y=r[9],E=r[10],w=r[11],e[8]=x*o+y*_+E*f+w*p,e[9]=x*n+y*l+E*c+w*d,e[10]=x*i+y*s+E*g+w*v,e[11]=x*a+y*u+E*h+w*m,x=r[12],y=r[13],E=r[14],w=r[15],e[12]=x*o+y*_+E*f+w*p,e[13]=x*n+y*l+E*c+w*d,e[14]=x*i+y*s+E*g+w*v,e[15]=x*a+y*u+E*h+w*m,e},c.mul=c.multiply,c.translate=function(e,t,r){var o,n,i,a,_,l,s,u,f,c,g,h,p=r[0],d=r[1],v=r[2];return t===e?(e[12]=t[0]*p+t[4]*d+t[8]*v+t[12],e[13]=t[1]*p+t[5]*d+t[9]*v+t[13],e[14]=t[2]*p+t[6]*d+t[10]*v+t[14],e[15]=t[3]*p+t[7]*d+t[11]*v+t[15]):(o=t[0],n=t[1],i=t[2],a=t[3],_=t[4],l=t[5],s=t[6],u=t[7],f=t[8],c=t[9],g=t[10],h=t[11],e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=_,e[5]=l,e[6]=s,e[7]=u,e[8]=f,e[9]=c,e[10]=g,e[11]=h,e[12]=o*p+_*d+f*v+t[12],e[13]=n*p+l*d+c*v+t[13],e[14]=i*p+s*d+g*v+t[14],e[15]=a*p+u*d+h*v+t[15]),e},c.scale=function(e,t,r){var o=r[0],n=r[1],i=r[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,r,o,n){var i,a,_,l,s,u,f,c,g,h,p,d,v,m,x,y,E,w,G,L,R,b,C,z,T=n[0],U=n[1],M=n[2],D=Math.sqrt(T*T+U*U+M*M);return Math.abs(D)<t?null:(D=1/D,T*=D,U*=D,M*=D,i=Math.sin(o),a=Math.cos(o),_=1-a,l=r[0],s=r[1],u=r[2],f=r[3],c=r[4],g=r[5],h=r[6],p=r[7],d=r[8],v=r[9],m=r[10],x=r[11],y=T*T*_+a,E=U*T*_+M*i,w=M*T*_-U*i,G=T*U*_-M*i,L=U*U*_+a,R=M*U*_+T*i,b=T*M*_+U*i,C=U*M*_-T*i,z=M*M*_+a,e[0]=l*y+c*E+d*w,e[1]=s*y+g*E+v*w,e[2]=u*y+h*E+m*w,e[3]=f*y+p*E+x*w,e[4]=l*G+c*L+d*R,e[5]=s*G+g*L+v*R,e[6]=u*G+h*L+m*R,e[7]=f*G+p*L+x*R,e[8]=l*b+c*C+d*z,e[9]=s*b+g*C+v*z,e[10]=u*b+h*C+m*z,e[11]=f*b+p*C+x*z,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},c.rotateX=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[4],a=t[5],_=t[6],l=t[7],s=t[8],u=t[9],f=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*n+s*o,e[5]=a*n+u*o,e[6]=_*n+f*o,e[7]=l*n+c*o,e[8]=s*n-i*o,e[9]=u*n-a*o,e[10]=f*n-_*o,e[11]=c*n-l*o,e},c.rotateY=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[0],a=t[1],_=t[2],l=t[3],s=t[8],u=t[9],f=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n-s*o,e[1]=a*n-u*o,e[2]=_*n-f*o,e[3]=l*n-c*o,e[8]=i*o+s*n,e[9]=a*o+u*n,e[10]=_*o+f*n,e[11]=l*o+c*n,e},c.rotateZ=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[0],a=t[1],_=t[2],l=t[3],s=t[4],u=t[5],f=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n+s*o,e[1]=a*n+u*o,e[2]=_*n+f*o,e[3]=l*n+c*o,e[4]=s*n-i*o,e[5]=u*n-a*o,e[6]=f*n-_*o,e[7]=c*n-l*o,e},c.fromRotationTranslation=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=o+o,l=n+n,s=i+i,u=o*_,f=o*l,c=o*s,g=n*l,h=n*s,p=i*s,d=a*_,v=a*l,m=a*s;return e[0]=1-(g+p),e[1]=f+m,e[2]=c-v,e[3]=0,e[4]=f-m,e[5]=1-(u+p),e[6]=h+d,e[7]=0,e[8]=c+v,e[9]=h-d,e[10]=1-(u+g),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},c.fromQuat=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r+r,_=o+o,l=n+n,s=r*a,u=o*a,f=o*_,c=n*a,g=n*_,h=n*l,p=i*a,d=i*_,v=i*l;return e[0]=1-f-h,e[1]=u+v,e[2]=c-d,e[3]=0,e[4]=u-v,e[5]=1-s-h,e[6]=g+p,e[7]=0,e[8]=c+d,e[9]=g-p,e[10]=1-s-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,r,o,n,i,a){var _=1/(r-t),l=1/(n-o),s=1/(i-a);return e[0]=2*i*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*l,e[6]=0,e[7]=0,e[8]=(r+t)*_,e[9]=(n+o)*l,e[10]=(a+i)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*s,e[15]=0,e},c.perspective=function(e,t,r,o,n){var i=1/Math.tan(t/2),a=1/(o-n);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+o)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*o*a,e[15]=0,e},c.ortho=function(e,t,r,o,n,i,a){var _=1/(t-r),l=1/(o-n),s=1/(i-a);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*s,e[11]=0,e[12]=(t+r)*_,e[13]=(n+o)*l,e[14]=(a+i)*s,e[15]=1,e},c.lookAt=function(e,r,o,n){var i,a,_,l,s,u,f,g,h,p,d=r[0],v=r[1],m=r[2],x=n[0],y=n[1],E=n[2],w=o[0],G=o[1],L=o[2];return Math.abs(d-w)<t&&Math.abs(v-G)<t&&Math.abs(m-L)<t?c.identity(e):(f=d-w,g=v-G,h=m-L,p=1/Math.sqrt(f*f+g*g+h*h),f*=p,g*=p,h*=p,i=y*h-E*g,a=E*f-x*h,_=x*g-y*f,p=Math.sqrt(i*i+a*a+_*_),p?(p=1/p,i*=p,a*=p,_*=p):(i=0,a=0,_=0),l=g*_-h*a,s=h*i-f*_,u=f*a-g*i,p=Math.sqrt(l*l+s*s+u*u),p?(p=1/p,l*=p,s*=p,u*=p):(l=0,s=0,u=0),e[0]=i,e[1]=l,e[2]=f,e[3]=0,e[4]=a,e[5]=s,e[6]=g,e[7]=0,e[8]=_,e[9]=u,e[10]=h,e[11]=0,e[12]=-(i*d+a*v+_*m),e[13]=-(l*d+s*v+u*m),e[14]=-(f*d+g*v+h*m),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},"undefined"!=typeof e&&(e.mat4=c);var g={};g.create=function(){var e=new r(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},g.rotationTo=function(){var e=_.create(),t=_.fromValues(1,0,0),r=_.fromValues(0,1,0);return function(o,n,i){var a=_.dot(n,i);return a<-.999999?(_.cross(e,t,n),_.length(e)<1e-6&&_.cross(e,r,n),_.normalize(e,e),g.setAxisAngle(o,e,Math.PI),o):a>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(_.cross(e,n,i),o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=1+a,g.normalize(o,o))}}(),g.setAxes=function(){var e=f.create();return function(t,r,o,n){return e[0]=o[0],e[3]=o[1],e[6]=o[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],g.normalize(t,g.fromMat3(t,e))}}(),g.clone=l.clone,g.fromValues=l.fromValues,g.copy=l.copy,g.set=l.set,g.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},g.setAxisAngle=function(e,t,r){r=.5*r;var o=Math.sin(r);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(r),e},g.add=l.add,g.multiply=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],_=r[0],l=r[1],s=r[2],u=r[3];return e[0]=o*u+a*_+n*s-i*l,e[1]=n*u+a*l+i*_-o*s,e[2]=i*u+a*s+o*l-n*_,e[3]=a*u-o*_-n*l-i*s,e},g.mul=g.multiply,g.scale=l.scale,g.rotateX=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],_=Math.sin(r),l=Math.cos(r);return e[0]=o*l+a*_,e[1]=n*l+i*_,e[2]=i*l-n*_,e[3]=a*l-o*_,e},g.rotateY=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],_=Math.sin(r),l=Math.cos(r);return e[0]=o*l-i*_,e[1]=n*l+a*_,e[2]=i*l+o*_,e[3]=a*l-n*_,e},g.rotateZ=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],_=Math.sin(r),l=Math.cos(r);return e[0]=o*l+n*_,e[1]=n*l-o*_,e[2]=i*l+a*_,e[3]=a*l-i*_,e},g.calculateW=function(e,t){var r=t[0],o=t[1],n=t[2];return e[0]=r,e[1]=o,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-r*r-o*o-n*n)),e},g.dot=l.dot,g.lerp=l.lerp,g.slerp=function(e,t,r,o){var n,i,a,_,l,s=t[0],u=t[1],f=t[2],c=t[3],g=r[0],h=r[1],p=r[2],d=r[3];return i=s*g+u*h+f*p+c*d,i<0&&(i=-i,g=-g,h=-h,p=-p,d=-d),1-i>1e-6?(n=Math.acos(i),a=Math.sin(n),_=Math.sin((1-o)*n)/a,l=Math.sin(o*n)/a):(_=1-o,l=o),e[0]=_*s+l*g,e[1]=_*u+l*h,e[2]=_*f+l*p,e[3]=_*c+l*d,e},g.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*r+o*o+n*n+i*i,_=a?1/a:0;return e[0]=-r*_,e[1]=-o*_,e[2]=-n*_,e[3]=i*_,e},g.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},g.length=l.length,g.len=g.length,g.squaredLength=l.squaredLength,g.sqrLen=g.squaredLength,g.normalize=l.normalize,g.fromMat3=function(e,t){var r,o=t[0]+t[4]+t[8];if(o>0)r=Math.sqrt(o+1),e[3]=.5*r,r=.5/r,e[0]=(t[7]-t[5])*r,e[1]=(t[2]-t[6])*r,e[2]=(t[3]-t[1])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*a+i]-t[3*i+a])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e},g.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.quat=g)}(t.exports)}(this),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.poly2tri=e()}}(function(){return function e(t,r,o){function n(a,_){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!_&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var s=r[a]={exports:{}};t[a][0].call(s.exports,function(e){var r=t[a][1][e];return n(r?r:e)},s,s.exports,e,t,r,o)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(e,t,r){t.exports={version:"1.3.5"}},{}],2:[function(e,t,r){"use strict";var o=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},n=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};n.prototype.head=function(){return this.head_},n.prototype.setHead=function(e){this.head_=e},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(e){this.tail_=e},n.prototype.search=function(){return this.search_node_},n.prototype.setSearch=function(e){this.search_node_=e},n.prototype.findSearchNode=function(){return this.search_node_},n.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},n.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),o=r.point.x;if(t===o){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<o)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=n,t.exports.Node=o},{}],3:[function(e,t,r){"use strict";function o(e,t){if(!e)throw new Error(t||"Assert Failed")}t.exports=o},{}],4:[function(e,t,r){"use strict";var o=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return o.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n((-e.x),(-e.y))},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=o.toString,n.compare=o.compare,n.cmp=o.compare,n.equals=o.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,r){"use strict";var o=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+o.toString(t[r])};n.prototype=new Error,n.prototype.constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,r){(function(t){"use strict";var o=t.poly2tri;r.noConflict=function(){return t.poly2tri=o,r},r.VERSION=e("../dist/version.json").version,r.PointError=e("./pointerror"),r.Point=e("./point"),r.Triangle=e("./triangle"),r.SweepContext=e("./sweepcontext");var n=e("./sweep");r.triangulate=n.triangulate,r.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function o(e){e.initTriangulation(),e.createAdvancingFront(),n(e),i(e)}function n(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var o=e.getPoint(t),n=a(e,o),i=o._p2t_edge_list,l=0;i&&l<i.length;++l)_(e,i[l],n);
}function i(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}function a(e,t){var r=e.locateNode(t),o=u(e,t,r);return t.x<=r.point.x+V&&f(e,r),c(e,o),o}function _(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,s(r.triangle,t.p,t.q)||(y(e,t,r),l(e,t.p,t.q,r.triangle,t.q))}function l(e,t,r,o,n){if(!s(o,t,r)){var i=o.pointCCW(n),a=W(r,i,t);if(a===N.COLLINEAR)throw new A("poly2tri EdgeEvent: Collinear not supported!",[r,i,t]);var _=o.pointCW(n),u=W(r,_,t);if(u===N.COLLINEAR)throw new A("poly2tri EdgeEvent: Collinear not supported!",[r,_,t]);a===u?(o=a===N.CW?o.neighborCCW(n):o.neighborCW(n),l(e,t,r,o,n)):T(e,t,r,o,n)}}function s(e,t,r){var o=e.edgeIndex(t,r);if(o!==-1){e.markConstrainedEdgeByIndex(o);var n=e.getNeighbor(o);return n&&n.markConstrainedEdgeByPoints(t,r),!0}return!1}function u(e,t,r){var o=new P(t,r.point,r.next.point);o.markNeighbor(r.triangle),e.addToMap(o);var n=new I(t);return n.next=r.next,n.prev=r,r.next.prev=n,r.next=n,h(e,o)||e.mapTriangleToNodes(o),n}function f(e,t){var r=new P(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,h(e,r)||e.mapTriangleToNodes(r)}function c(e,t){for(var r=t.next;r.next&&!q(r.point,r.next.point,r.prev.point);)f(e,r),r=r.next;for(r=t.prev;r.prev&&!q(r.point,r.next.point,r.prev.point);)f(e,r),r=r.prev;t.next&&t.next.next&&g(t)&&v(e,t)}function g(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return S(r>=0,"unordered y"),t>=0||Math.abs(t)<r}function h(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var o=t.getNeighbor(r);if(o){var n=t.getPoint(r),i=o.oppositePoint(t,n),a=o.index(i);if(o.constrained_edge[a]||o.delaunay_edge[a]){t.constrained_edge[r]=o.constrained_edge[a];continue}var _=p(n,t.pointCCW(n),t.pointCW(n),i);if(_){t.delaunay_edge[r]=!0,o.delaunay_edge[a]=!0,d(t,n,o,i);var l=!h(e,t);return l&&e.mapTriangleToNodes(t),l=!h(e,o),l&&e.mapTriangleToNodes(o),t.delaunay_edge[r]=!1,o.delaunay_edge[a]=!1,!0}}}return!1}function p(e,t,r,o){var n=e.x-o.x,i=e.y-o.y,a=t.x-o.x,_=t.y-o.y,l=n*_,s=a*i,u=l-s;if(u<=0)return!1;var f=r.x-o.x,c=r.y-o.y,g=f*i,h=n*c,p=g-h;if(p<=0)return!1;var d=a*c,v=f*_,m=n*n+i*i,x=a*a+_*_,y=f*f+c*c,E=m*(d-v)+x*p+y*u;return E>0}function d(e,t,r,o){var n,i,a,_;n=e.neighborCCW(t),i=e.neighborCW(t),a=r.neighborCCW(o),_=r.neighborCW(o);var l,s,u,f;l=e.getConstrainedEdgeCCW(t),s=e.getConstrainedEdgeCW(t),u=r.getConstrainedEdgeCCW(o),f=r.getConstrainedEdgeCW(o);var c,g,h,p;c=e.getDelaunayEdgeCCW(t),g=e.getDelaunayEdgeCW(t),h=r.getDelaunayEdgeCCW(o),p=r.getDelaunayEdgeCW(o),e.legalize(t,o),r.legalize(o,t),r.setDelaunayEdgeCCW(t,c),e.setDelaunayEdgeCW(t,g),e.setDelaunayEdgeCCW(o,h),r.setDelaunayEdgeCW(o,p),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,s),e.setConstrainedEdgeCCW(o,u),r.setConstrainedEdgeCW(o,f),e.clearNeighbors(),r.clearNeighbors(),n&&r.markNeighbor(n),i&&e.markNeighbor(i),a&&e.markNeighbor(a),_&&r.markNeighbor(_),e.markNeighbor(r)}function v(e,t){for(W(t.point,t.next.point,t.next.next.point)===N.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,m(e,e.basin.bottom_node))}}function m(e,t){if(!x(e,t)){f(e,t);var r;if(t.prev!==e.basin.left_node||t.next!==e.basin.right_node){if(t.prev===e.basin.left_node){if(r=W(t.point,t.next.point,t.next.next.point),r===N.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(r=W(t.point,t.prev.point,t.prev.prev.point),r===N.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;m(e,t)}}}function x(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}function y(e,t,r){e.edge_event.right?E(e,t,r):R(e,t,r)}function E(e,t,r){for(;r.next.point.x<t.p.x;)W(t.q,r.next.point,t.p)===N.CCW?w(e,t,r):r=r.next}function w(e,t,r){r.point.x<t.p.x&&(W(r.point,r.next.point,r.next.next.point)===N.CCW?G(e,t,r):(L(e,t,r),w(e,t,r)))}function G(e,t,r){f(e,r.next),r.next.point!==t.p&&W(t.q,r.next.point,t.p)===N.CCW&&W(r.point,r.next.point,r.next.next.point)===N.CCW&&G(e,t,r)}function L(e,t,r){W(r.next.point,r.next.next.point,r.next.next.next.point)===N.CCW?G(e,t,r.next):W(t.q,r.next.next.point,t.p)===N.CCW&&L(e,t,r.next)}function R(e,t,r){for(;r.prev.point.x>t.p.x;)W(t.q,r.prev.point,t.p)===N.CW?b(e,t,r):r=r.prev}function b(e,t,r){r.point.x>t.p.x&&(W(r.point,r.prev.point,r.prev.prev.point)===N.CW?z(e,t,r):(C(e,t,r),b(e,t,r)))}function C(e,t,r){W(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===N.CW?z(e,t,r.prev):W(t.q,r.prev.prev.point,t.p)===N.CW&&C(e,t,r.prev)}function z(e,t,r){f(e,r.prev),r.prev.point!==t.p&&W(t.q,r.prev.point,t.p)===N.CW&&W(r.point,r.prev.point,r.prev.prev.point)===N.CW&&z(e,t,r)}function T(e,t,r,o,n){var i=o.neighborAcross(n);S(i,"FLIP failed due to missing triangle!");var a=i.oppositePoint(o,n);if(o.getConstrainedEdgeAcross(n)){var _=o.index(n);throw new A("poly2tri Intersecting Constraints",[n,a,o.getPoint((_+1)%3),o.getPoint((_+2)%3)])}if(O(n,o.pointCCW(n),o.pointCW(n),a))if(d(o,n,i,a),e.mapTriangleToNodes(o),e.mapTriangleToNodes(i),n===r&&a===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(o.markConstrainedEdgeByPoints(t,r),i.markConstrainedEdgeByPoints(t,r),h(e,o),h(e,i));else{var s=W(r,a,t);o=U(e,s,o,i,n,a),T(e,t,r,o,n)}else{var u=M(t,r,i,a);D(e,t,r,o,i,u),l(e,t,r,o,n)}}function U(e,t,r,o,n,i){var a;return t===N.CCW?(a=o.edgeIndex(n,i),o.delaunay_edge[a]=!0,h(e,o),o.clearDelaunayEdges(),r):(a=r.edgeIndex(n,i),r.delaunay_edge[a]=!0,h(e,r),r.clearDelaunayEdges(),o)}function M(e,t,r,o){var n=W(t,o,e);if(n===N.CW)return r.pointCCW(o);if(n===N.CCW)return r.pointCW(o);throw new A("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,o,e])}function D(e,t,r,o,n,i){var a=n.neighborAcross(i);S(a,"FLIP failed due to missing triangle");var _=a.oppositePoint(n,i);if(O(r,o.pointCCW(r),o.pointCW(r),_))T(e,r,_,a,_);else{var l=M(t,r,a,_);D(e,t,r,o,a,l)}}var S=e("./assert"),A=e("./pointerror"),P=e("./triangle"),I=e("./advancingfront").Node,F=e("./utils"),V=F.EPSILON,N=F.Orientation,W=F.orient2d,O=F.inScanArea,q=F.isAngleObtuse;r.triangulate=o},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var o=e("./pointerror"),n=e("./point"),i=e("./triangle"),a=e("./sweep"),_=e("./advancingfront"),l=_.Node,s=.3,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new o("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},f=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};f.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var c=function(){this.constrained_edge=null,this.right=!1},g=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new f,this.edge_event=new c,this.initEdges(this.points_)};g.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},g.prototype.AddHole=g.prototype.addHole,g.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},g.prototype.addPoint=function(e){return this.points_.push(e),this},g.prototype.AddPoint=g.prototype.addPoint,g.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},g.prototype.triangulate=function(){return a.triangulate(this),this},g.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},g.prototype.getTriangles=function(){return this.triangles_},g.prototype.GetTriangles=g.prototype.getTriangles,g.prototype.front=function(){return this.front_},g.prototype.pointCount=function(){return this.points_.length},g.prototype.head=function(){return this.head_},g.prototype.setHead=function(e){this.head_=e},g.prototype.tail=function(){return this.tail_},g.prototype.setTail=function(e){this.tail_=e},g.prototype.getMap=function(){return this.map_},g.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,o=this.points_[0].y,i=this.points_[0].y,a=this.points_.length;for(e=1;e<a;e++){var _=this.points_[e];_.x>t&&(t=_.x),_.x<r&&(r=_.x),_.y>o&&(o=_.y),_.y<i&&(i=_.y)}this.pmin_=new n(r,i),this.pmax_=new n(t,o);var l=s*(t-r),u=s*(o-i);this.head_=new n(t+l,i-u),this.tail_=new n(r-l,i-u),this.points_.sort(n.compare)},g.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new u(e[t],e[(t+1)%r]))},g.prototype.getPoint=function(e){return this.points_[e]},g.prototype.addToMap=function(e){this.map_.push(e)},g.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},g.prototype.createAdvancingFront=function(){var e,t,r,o=new i(this.points_[0],this.tail_,this.head_);this.map_.push(o),e=new l(o.getPoint(1),o),t=new l(o.getPoint(0),o),r=new l(o.getPoint(2)),this.front_=new _(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},g.prototype.removeNode=function(e){},g.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},g.prototype.removeFromMap=function(e){var t,r=this.map_,o=r.length;for(t=0;t<o;t++)if(r[t]===e){r.splice(t,1);break}},g.prototype.meshClean=function(e){for(var t,r,o=[e];t=o.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||o.push(t.getNeighbor(r))},t.exports=g},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var o=e("./xy"),n=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},i=o.toString;n.prototype.toString=function(){return"["+i(this.points_[0])+i(this.points_[1])+i(this.points_[2])+"]"},n.prototype.getPoint=function(e){return this.points_[e]},n.prototype.GetPoint=n.prototype.getPoint,n.prototype.getPoints=function(){return this.points_},n.prototype.getNeighbor=function(e){return this.neighbors_[e]},n.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},n.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},n.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},n.prototype.isInterior=function(){return this.interior_},n.prototype.setInterior=function(e){return this.interior_=e,this},n.prototype.markNeighborPointers=function(e,t,r){var o=this.points_;if(e===o[2]&&t===o[1]||e===o[1]&&t===o[2])this.neighbors_[0]=r;else if(e===o[0]&&t===o[2]||e===o[2]&&t===o[0])this.neighbors_[1]=r;else{if(!(e===o[0]&&t===o[1]||e===o[1]&&t===o[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},n.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},n.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},n.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},n.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},n.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},n.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},n.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},n.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},n.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},n.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},n.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},n.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},n.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},n.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},n.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},n.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},n.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},n.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},n.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},n.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},n.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},n.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},n.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},n.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=n},{"./xy":11}],10:[function(e,t,r){"use strict";function o(e,t,r){var o=(e.x-r.x)*(t.y-r.y),n=(e.y-r.y)*(t.x-r.x),i=o-n;return i>-1e-12&&i<a?_.COLLINEAR:i>0?_.CCW:_.CW}function n(e,t,r,o){var n=(e.x-t.x)*(o.y-t.y)-(o.x-t.x)*(e.y-t.y);if(n>=-1e-12)return!1;var i=(e.x-r.x)*(o.y-r.y)-(o.x-r.x)*(e.y-r.y);return!(i<=a)}function i(e,t,r){var o=t.x-e.x,n=t.y-e.y,i=r.x-e.x,a=r.y-e.y;return o*i+n*a<0}var a=1e-12;r.EPSILON=a;var _={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=_,r.orient2d=o,r.inScanArea=n,r.isAngleObtuse=i},{}],11:[function(e,t,r){"use strict";function o(e){return"("+e.x+";"+e.y+")"}function n(e){var t=e.toString();return"[object Object]"===t?o(e):t}function i(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function a(e,t){return e.x===t.x&&e.y===t.y}t.exports={toString:n,toStringBase:o,compare:i,equals:a}},{}]},{},[6])(6)}),G.GLShaderUtil={compile:function(e,t,r){if(!e)return void console.error("No WebGL context!");var o=e.createShader(t);return e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)===!1&&console.error("Compile shader error:\n",r),o},genProgram:function(e,t,r){if(!e)return void console.error("No WebGL context!");var o=e.createProgram();return e.attachShader(o,t),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||(console.error("Link WebGL program error"),e.deleteProgram(o),e.deleteShader(t),e.deleteShader(r)),o},TILE_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","attribute vec2 a_pt;","attribute vec2 a_texcoord;","varying vec2 v_texcoord;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x - u_center.x) /u_res;","float y = hh - (a_pt.y - u_center.y) /u_res;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","v_texcoord = a_texcoord;","}"];return e.join("\n")}(),TILE_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","uniform float u_alpha;","uniform sampler2D u_sampler;","varying vec2 v_texcoord;","void main(){","vec4 v_color = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));","gl_FragColor = vec4(v_color.rgb, v_color.a * u_alpha);","}"];return e.join("\n")}(),PT_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","attribute vec2 a_pt;","uniform vec4 u_color;","uniform vec2 u_shape_size;","uniform vec2 u_offset;","varying vec4 v_color;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh + u_offset.y;","}","x += u_offset.x;","y += u_offset.y;","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","gl_PointSize = u_shape_size.x;","v_color = u_color;","}"];return e.join("\n")}(),PT_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 v_color;","void main(){","gl_FragColor = v_color;","}"];return e.join("\n")}(),LINE_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","attribute vec2 a_pt;","uniform vec4 u_color;","varying vec4 v_color;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","v_color = u_color;","}"];return e.join("\n")}(),LINE_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 v_color;","void main(){","gl_FragColor = v_color;","}"];return e.join("\n")}(),FILL_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","attribute vec2 a_pt;","uniform float u_fill_image;","uniform vec2 u_image_size;","uniform float u_alpha;","uniform vec4 u_color;","varying float v_fill_image;","varying vec2 v_texcoord;","varying float v_alpha;","varying vec4 v_color;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","v_color = u_color;","v_alpha = u_alpha;","v_fill_image = u_fill_image;","if( v_fill_image!=0.0 ){","float imageWidth = u_image_size.x;","float imageHeight = u_image_size.y;","float texcoordX = x/imageWidth;","float texcoordY = y/imageHeight;","v_texcoord = vec2(texcoordX, texcoordY);","}","}"];return e.join("\n")}(),FILL_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","uniform sampler2D u_sampler;","varying float v_fill_image;","varying vec2 v_texcoord;","varying float v_alpha;","varying vec4 v_color;","void main(){","if( v_fill_image!=0.0 ){","vec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));","gl_FragColor = vec4(tex.rgb, tex.a * v_alpha);","}else{","gl_FragColor = v_color;","}","}"];return e.join("\n")}(),SHAPE_FILL_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","const float PI_2 = 2.0*3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_canvas_scale;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","uniform int u_shape;","uniform float u_size_x;","uniform float u_size_y;","uniform float u_offset_x;","uniform float u_offset_y;","attribute vec3 a_pt;","uniform float u_fill_image;","uniform vec2 u_image_size;","uniform float u_alpha;","uniform vec4 u_color;","uniform vec4 u_color_center;","varying float v_fill_image;","varying vec2 v_texcoord;","varying float v_alpha;","varying vec4 v_color;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;","float z = a_pt.z;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","float hw_shape = u_size_x/2.0;","float hh_shape = u_size_y/2.0;","if(u_shape==1){","if(z!=-1.0){","float theta = PI_2*z;","x += hw_shape * sin(theta);","y += hw_shape * cos(theta);","}","}else if(u_shape==2){","if(z==1.0){","x -= hw_shape;","y -= hh_shape;","}else if(z==2.0){","x += hw_shape;","y -= hh_shape;","}else if(z==3.0){","x += hw_shape;","y += hh_shape;","}else if(z==4.0){","x -= hw_shape;","y += hh_shape;","}","}","x += u_offset_x;","y += u_offset_y;","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","if(u_shape==1){","if(z!=-1.0){","v_color = u_color;","} else {","v_color = u_color_center;","}","}else if(u_shape==2){","if(z!=0.0){","v_color = u_color;","} else {","v_color = u_color_center;","}","}","v_alpha = u_alpha;","v_fill_image = u_fill_image;","if( v_fill_image!=0.0 ){","float imageWidth = u_image_size.x;","float imageHeight = u_image_size.y;","float texcoordX = x/imageWidth;","float texcoordY = y/imageHeight;","v_texcoord = vec2(texcoordX, texcoordY);","}","}"];return e.join("\n")}(),SHAPE_FILL_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","uniform sampler2D u_sampler;","varying float v_fill_image;","varying vec2 v_texcoord;","varying float v_alpha;","varying vec4 v_color;","void main(){","if( v_fill_image!=0.0 ){","vec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));","gl_FragColor = vec4(tex.rgb, tex.a * v_alpha);","}else{","gl_FragColor = v_color;","}","}"];return e.join("\n")}(),SHAPE_LINE_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","const float PI_2 = 2.0*3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_canvas_scale;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","uniform int u_shape;","uniform float u_size_x;","uniform float u_size_y;","uniform float u_offset_x;","uniform float u_offset_y;","attribute vec3 a_pt;","uniform vec4 u_color;","varying vec4 v_color;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;","float z = a_pt.z;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","float hw_shape = u_size_x / 2.0;","float hh_shape = u_size_y / 2.0;","if(u_shape==1){","if(z!=-1.0){","float theta = PI_2*z;","x += hw_shape * sin(theta);","y += hw_shape * cos(theta);","}","}else if(u_shape==2){","if(z==1.0){","x -= hw_shape;","y -= hh_shape;","}else if(z==2.0){","x += hw_shape;","y -= hh_shape;","}else if(z==3.0){","x += hw_shape;","y += hh_shape;","}else if(z==4.0){","x -= hw_shape;","y += hh_shape;","}","}","x += u_offset_x;","y += u_offset_y;","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","v_color = u_color;","}"];return e.join("\n")}(),SHAPE_LINE_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 v_color;","void main(){","gl_FragColor = v_color;","}"];return e.join("\n")}(),SHAPE_IMAGE_VS:function(){var e=["const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;","void rotate(in vec2 v, in float theta, out vec2 result) {","float c = cos(theta);","float s = sin(theta);","result = vec2(c*v.x - s*v.y, s*v.x + c*v.y);","}","uniform mat4 u_mv, u_p;","uniform vec2 u_canvas_offset;","uniform vec2 u_canvas_scale;","uniform vec2 u_graphic_offset;","uniform vec2 u_zoom_around;","uniform float u_zoom_scale;","uniform int u_ignore_rotate;","uniform float u_res;","uniform vec2 u_center;","uniform vec2 u_size;","uniform float u_rotate;","uniform float u_size_x;","uniform float u_size_y;","uniform float u_offset_x;","uniform float u_offset_y;","uniform float u_image_rotate;","uniform float u_texture_size;","attribute vec3 a_pt;","varying vec2 v_texcoord;","void main(){","float hw = u_size.x/2.0;","float hh = u_size.y/2.0;","float x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;","float y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;","float z = a_pt.z;","if( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {","float zoom_delta = 1.0/u_zoom_scale - 1.0;","x += (x - u_zoom_around.x)*zoom_delta;","y += (y - u_zoom_around.y)*zoom_delta;","}","float dx = x - hw;","float dy = y - hh;","if( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {","float theta = u_rotate/DEGREE_PER_RADIAN;","vec2 v;","rotate(vec2(dx, dy), theta, v);","x = v.x + hw;","y = v.y + hh;","}","float hw_shape = u_size_x/2.0;","float hh_shape = u_size_y/2.0;","float texcoordX = 0.0;","float texcoordY = 0.0;","float vx = u_offset_x;","float vy = u_offset_y;","if(z==0.0){","vx += hw_shape;","vy += hh_shape;","texcoordX = hw_shape/u_texture_size;","texcoordY = (u_texture_size - hh_shape)/u_texture_size;","}else if(z==1.0){","texcoordY = 1.0;","}else if(z==2.0){","vx += u_size_x;","texcoordX = u_size_x/u_texture_size;","texcoordY = 1.0;","}else if(z==3.0){","vx += u_size_x;","vy += u_size_y;","texcoordX = u_size_x/u_texture_size;","texcoordY = (u_texture_size - u_size_y)/u_texture_size;","}else if(z==4.0){","vy += u_size_y;","texcoordY = (u_texture_size - u_size_y)/u_texture_size;","}","v_texcoord = vec2(texcoordX, texcoordY);","float ra = u_image_rotate/DEGREE_PER_RADIAN;","vec2 rv;","rotate(vec2(vx, vy), ra, rv);","x += rv.x;","y += rv.y;","x += u_canvas_offset.x;","y += u_canvas_offset.y;","gl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);","}"];
return e.join("\n")}(),SHAPE_IMAGE_FS:function(){var e=["#ifdef GL_ES","precision highp float;","#endif","uniform sampler2D u_sampler;","varying vec2 v_texcoord;","void main(){","gl_FragColor = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));","}"];return e.join("\n")}()},G.GLCamera=G.Class.extend({init:function(){var e=this;e._pos=vec3.create(),e._target=vec3.create(),e._up=vec3.fromValues(0,1,0),e._mvMatrix=mat4.create(),e._pMatrix=mat4.create()},moveTo:function(e,t,r){var o=this;return vec3.set(o._pos,e,t,r),mat4.lookAt(o._mvMatrix,o._pos,o._target,o._up),o},lookAt:function(e,t,r){var o=this;return vec3.set(o._target,e,t,r),mat4.lookAt(o._mvMatrix,o._pos,o._target,o._up),o}}),G.GLOrthoCamera=G.GLCamera.extend({init:function(e,t,r,o,n,i){var a=this;G.GLCamera.prototype.init.call(a),a.left=e,a.right=t,a.bottom=r,a.top=o,a.near=void 0===n?1:n,a.far=void 0===i?2e8:i,a._updatePMatrix()},_updatePMatrix:function(){var e=this;return mat4.ortho(e._pMatrix,e.left,e.right,e.bottom,e.top,e.near,e.far),e}}),G.GLDrawUtil={_tileIndices:new Uint16Array([0,1,2,0,2,3]),_tileTextureCoords:new Float32Array([0,1,1,1,1,0,0,0]),_bufferFloat32Array:function(e,t,r,o,n){e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null)},drawTile:function(e,t,r,o){var n=this,i=e._map;if(i){var a,_=i._gl,l=i._camera,s=i._canvasOffset,u=i.getCenter(),f=i.getSize(),c=e._zoomScale||e._scale,g=e._aroundScreen||[];if(t._loaded&&(t._gl_t||(a=t._gl_t=_.createTexture(),_.bindTexture(_.TEXTURE_2D,a),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null)),a=t._gl_t)){var h=_.tileProgram;_.useProgram(h);var p=t._gl_u_mv=t._gl_u_mv||_.getUniformLocation(h,"u_mv"),d=t._gl_u_p=t._gl_u_p||_.getUniformLocation(h,"u_p"),v=t._gl_u_canvas_offset=t._gl_u_canvas_offset||_.getUniformLocation(h,"u_canvas_offset"),m=t._gl_u_zoom_around=t._gl_u_zoom_around||_.getUniformLocation(h,"u_zoom_around"),x=t._gl_u_zoom_scale=t._gl_u_zoom_scale||_.getUniformLocation(h,"u_zoom_scale"),y=t._gl_u_ignore_rotate=t._gl_u_ignore_rotate||_.getUniformLocation(h,"u_ignore_rotate"),E=t._gl_u_res=t._gl_u_res||_.getUniformLocation(h,"u_res"),w=t._gl_u_center=t._gl_u_center||_.getUniformLocation(h,"u_center"),G=t._gl_u_size=t._gl_u_size||_.getUniformLocation(h,"u_size"),L=t._gl_u_rotate=t._gl_u_rotate||_.getUniformLocation(h,"u_rotate"),R=t._gl_a_pt=t._gl_a_pt||_.getAttribLocation(h,"a_pt"),b=t._gl_u_sampler=t._gl_u_sampler||_.getUniformLocation(h,"u_sampler"),C=t._gl_a_texcoord=t._gl_a_texcoord||_.getAttribLocation(h,"a_texcoord"),z=t._gl_u_alpha=t._gl_u_alpha||_.getUniformLocation(h,"u_alpha");_.uniformMatrix4fv(p,!1,l._mvMatrix),_.uniformMatrix4fv(d,!1,l._pMatrix),_.uniform2f(v,s[0],s[1]),_.uniform2f(m,g[0]||0,g[1]||0),_.uniform1f(x,c||1),_.uniform1i(y,1),_.uniform1f(E,i._res),_.uniform2f(w,u[0],u[1]),_.uniform2f(G,f[0],f[1]),_.uniform1f(L,i._rotate),_.uniform1f(z,o||1);var T=t._gl_vb=t._gl_vb||_.createBuffer(),U=t._gl_ib=t._gl_ib||_.createBuffer(),M=t._gl_tcb=t._gl_tcb||_.createBuffer();n._bufferFloat32Array(_,T,new Float32Array(r),R,2),n._bufferFloat32Array(_,M,n._tileTextureCoords,C,2),_.activeTexture(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,a),_.uniform1i(b,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,U),_.bufferData(_.ELEMENT_ARRAY_BUFFER,n._tileIndices,_.STATIC_DRAW),_.drawElements(_.TRIANGLES,n._tileIndices.length,_.UNSIGNED_SHORT,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindTexture(_.TEXTURE_2D,null)}}},drawLine:function(e,t,r,o,n,i,a,_){var l=this,s=e._layer,u=s._map;if(!(e._gl_line_vcount<2)){var f=u._gl,c=u._camera,g=u._canvasOffset,h=(u._canvasScale,u.getCenter()),p=u.getSize(),d=s._zoomScale||s._scale,v=s._aroundScreen||[],m=f.lineProgram;f.useProgram(m);var x=e._gl_l_u_mv=e._gl_l_u_mv||f.getUniformLocation(m,"u_mv"),y=e._gl_l_u_p=e._gl_l_u_p||f.getUniformLocation(m,"u_p"),E=e._gl_l_u_canvas_offset=e._gl_l_u_canvas_offset||f.getUniformLocation(m,"u_canvas_offset"),w=e._gl_l_u_graphic_offset=e._gl_l_u_graphic_offset||f.getUniformLocation(m,"u_graphic_offset"),G=e._gl_l_u_zoom_around=e._gl_l_u_zoom_around||f.getUniformLocation(m,"u_zoom_around"),L=e._gl_l_u_zoom_scale=e._gl_l_u_zoom_scale||f.getUniformLocation(m,"u_zoom_scale"),R=e._gl_l_u_ignore_rotate=e._gl_l_u_ignore_rotate||f.getUniformLocation(m,"u_ignore_rotate"),b=e._gl_l_u_res=e._gl_l_u_res||f.getUniformLocation(m,"u_res"),C=e._gl_l_u_center=e._gl_l_u_center||f.getUniformLocation(m,"u_center"),z=e._gl_l_u_size=e._gl_l_u_size||f.getUniformLocation(m,"u_size"),T=e._gl_l_u_rotate=e._gl_l_u_rotate||f.getUniformLocation(m,"u_rotate"),U=e._gl_l_a_pt=e._gl_l_a_pt||f.getAttribLocation(m,"a_pt"),M=e._gl_l_u_color=e._gl_l_u_color||f.getUniformLocation(m,"u_color");f.uniformMatrix4fv(x,!1,c._mvMatrix),f.uniformMatrix4fv(y,!1,c._pMatrix),f.uniform2f(E,g[0],g[1]),f.uniform2f(w,t[0]||0,t[1]||0),f.uniform2f(G,v[0]||0,v[1]||0),f.uniform1f(L,d||1),f.uniform1i(R,1),f.uniform1f(b,u._res),f.uniform2f(C,h[0],h[1]),f.uniform2f(z,p[0],p[1]),f.uniform1f(T,u._rotate),f.uniform4f(M,r[0]/255,r[1]/255,r[2]/255,o),f.lineWidth(n);var D=e._gl_line_vb=e._gl_line_vb||f.createBuffer();l._bufferFloat32Array(f,D,e._gl_line_vs,U,2),f.bindBuffer(f.ARRAY_BUFFER,D);for(var S,A=0,P=0,I=e._gl_line_vcounts.length;P<I;P++)S=e._gl_line_vcounts[P],S>1&&f.drawArrays(f.LINE_STRIP,A,S),A+=S;f.bindBuffer(f.ARRAY_BUFFER,null)}},drawFill:function(e,t,r,o,n,i){var a=this,_=e._layer,l=_._map;if(!(e._gl_fill_vcount<3)){var s=l._gl,u=l._camera,f=l._canvasOffset,c=l.getCenter(),g=l.getSize(),h=_._zoomScale||_._scale,p=_._aroundScreen||[],d=s.fillProgram;s.useProgram(d);var v=e._gl_f_u_mv=e._gl_f_u_mv||s.getUniformLocation(d,"u_mv"),m=e._gl_f_u_p=e._gl_f_u_p||s.getUniformLocation(d,"u_p"),x=e._gl_f_u_canvas_offset=e._gl_f_u_canvas_offset||s.getUniformLocation(d,"u_canvas_offset"),y=e._gl_f_u_graphic_offset=e._gl_f_u_graphic_offset||s.getUniformLocation(d,"u_graphic_offset"),E=e._gl_f_u_zoom_around=e._gl_f_u_zoom_around||s.getUniformLocation(d,"u_zoom_around"),w=e._gl_f_u_zoom_scale=e._gl_f_u_zoom_scale||s.getUniformLocation(d,"u_zoom_scale"),G=e._gl_f_u_ignore_rotate=e._gl_f_u_ignore_rotate||s.getUniformLocation(d,"u_ignore_rotate"),L=e._gl_f_u_res=e._gl_f_u_res||s.getUniformLocation(d,"u_res"),R=e._gl_f_u_center=e._gl_f_u_center||s.getUniformLocation(d,"u_center"),b=e._gl_f_u_size=e._gl_f_u_size||s.getUniformLocation(d,"u_size"),C=e._gl_f_u_rotate=e._gl_f_u_rotate||s.getUniformLocation(d,"u_rotate"),z=e._gl_f_a_pt=e._gl_f_a_pt||s.getAttribLocation(d,"a_pt"),T=e._gl_f_u_fill_image=e._gl_f_u_fill_image||s.getUniformLocation(d,"u_fill_image"),U=e._gl_f_u_image_size=e._gl_f_u_image_size||s.getUniformLocation(d,"u_image_size"),M=e._gl_f_u_sampler=e._gl_f_u_sampler||s.getUniformLocation(d,"u_sampler"),D=(e._gl_f_a_texcoord=e._gl_f_a_texcoord||s.getAttribLocation(d,"a_texcoord"),e._gl_f_u_alpha=e._gl_f_u_alpha||s.getUniformLocation(d,"u_alpha")),S=e._gl_f_u_color=e._gl_f_u_color||s.getUniformLocation(d,"u_color");s.uniformMatrix4fv(v,!1,u._mvMatrix),s.uniformMatrix4fv(m,!1,u._pMatrix),s.uniform2f(x,f[0],f[1]),s.uniform2f(y,t[0]||0,t[1]||0),s.uniform2f(E,p[0]||0,p[1]||0),s.uniform1f(w,h||1),s.uniform1i(G,1),s.uniform1f(L,l._res),s.uniform2f(R,c[0],c[1]),s.uniform2f(b,g[0],g[1]),s.uniform1f(C,l._rotate),s.uniform1f(T,o?1:0),s.uniform1f(D,i);var A=e._gl_fill_vb=e._gl_fill_vb||s.createBuffer();if(a._bufferFloat32Array(s,A,e._gl_fill_vs,z,2),o){s.uniform2f(U,n[0],n[1]),a._ensureImageTexture(o,n,l._textureCtx,s.REPEAT);var P=o._gl_t;if(!P)return;s.uniform2f(U,n[0],n[1]),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,P),s.uniform1i(M,0)}else s.uniform4f(S,r[0]/255,r[1]/255,r[2]/255,i);s.bindBuffer(s.ARRAY_BUFFER,A),s.drawArrays(s.TRIANGLES,0,e._gl_fill_vcount),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindTexture(s.TEXTURE_2D,null)}},drawShapeFill:function(e,t,r,o,n,i,a,_,l,s){var u=this,f=e._layer,c=f._map;if(!(e._gl_fill_vcount<3)){var g=c._gl,h=c._camera,p=c._canvasOffset,d=c._canvasScale,v=c.getCenter(),m=c.getSize(),x=f._zoomScale||f._scale,y=f._aroundScreen||[],E=g.shapeFillProgram;g.useProgram(E);var w=e._gl_sf_u_mv=e._gl_sf_u_mv||g.getUniformLocation(E,"u_mv"),G=e._gl_sf_u_p=e._gl_sf_u_p||g.getUniformLocation(E,"u_p"),L=e._gl_sf_u_canvas_offset=e._gl_sf_u_canvas_offset||g.getUniformLocation(E,"u_canvas_offset"),R=e._gl_sf_u_canvas_scale=e._gl_sf_u_canvas_scale||g.getUniformLocation(E,"u_canvas_scale"),b=e._gl_sf_u_graphic_offset=e._gl_sf_u_graphic_offset||g.getUniformLocation(E,"u_graphic_offset"),C=e._gl_sf_u_zoom_around=e._gl_sf_u_zoom_around||g.getUniformLocation(E,"u_zoom_around"),z=e._gl_sf_u_zoom_scale=e._gl_sf_u_zoom_scale||g.getUniformLocation(E,"u_zoom_scale"),T=e._gl_sf_u_ignore_rotate=e._gl_sf_u_ignore_rotate||g.getUniformLocation(E,"u_ignore_rotate"),U=e._gl_sf_u_res=e._gl_sf_u_res||g.getUniformLocation(E,"u_res"),M=e._gl_sf_u_center=e._gl_sf_u_center||g.getUniformLocation(E,"u_center"),D=e._gl_sf_u_size=e._gl_sf_u_size||g.getUniformLocation(E,"u_size"),S=e._gl_sf_u_rotate=e._gl_sf_u_rotate||g.getUniformLocation(E,"u_rotate"),A=e._gl_sf_u_shape=e._gl_sf_u_shape||g.getUniformLocation(E,"u_shape"),P=e._gl_sf_u_size_x=e._gl_sf_u_size_x||g.getUniformLocation(E,"u_size_x"),I=e._gl_sf_u_size_y=e._gl_sf_u_size_y||g.getUniformLocation(E,"u_size_y"),F=e._gl_sf_u_offset_x=e._gl_sf_u_offset_x||g.getUniformLocation(E,"u_offset_x"),V=e._gl_sf_u_offset_y=e._gl_sf_u_offset_y||g.getUniformLocation(E,"u_offset_y"),N=e._gl_sf_a_pt=e._gl_sf_a_pt||g.getAttribLocation(E,"a_pt"),W=e._gl_sf_u_fill_image=e._gl_sf_u_fill_image||g.getUniformLocation(E,"u_fill_image"),O=e._gl_sf_u_image_size=e._gl_sf_u_image_size||g.getUniformLocation(E,"u_image_size"),q=e._gl_sf_u_sampler=e._gl_sf_u_sampler||g.getUniformLocation(E,"u_sampler"),B=(e._gl_sf_a_texcoord=e._gl_sf_a_texcoord||g.getAttribLocation(E,"a_texcoord"),e._gl_sf_u_alpha=e._gl_sf_u_alpha||g.getUniformLocation(E,"u_alpha")),k=e._gl_sf_u_color=e._gl_sf_u_color||g.getUniformLocation(E,"u_color"),X=e._gl_sf_u_color_center=e._gl_sf_u_color_center||g.getUniformLocation(E,"u_color_center");g.uniformMatrix4fv(w,!1,h._mvMatrix),g.uniformMatrix4fv(G,!1,h._pMatrix),g.uniform2f(L,p[0],p[1]),g.uniform2f(R,d[0],d[1]),g.uniform2f(b,t[0]||0,t[1]||0),g.uniform2f(C,y[0]||0,y[1]||0),g.uniform1f(z,x||1),g.uniform1i(T,1),g.uniform1f(U,c._res),g.uniform2f(M,v[0],v[1]),g.uniform2f(D,m[0],m[1]),g.uniform1f(S,c._rotate),"circle"==r?g.uniform1i(A,1):"rect"==r&&g.uniform1i(A,2),g.uniform1f(P,o[0]||0),g.uniform1f(I,o[1]||0),g.uniform1f(F,n[0]||0),g.uniform1f(V,n[1]||0),g.uniform1f(W,a?1:0),g.uniform1f(B,l);var H=e._gl_fill_vb=e._gl_fill_vb||g.createBuffer();if(u._bufferFloat32Array(g,H,e._gl_fill_vs,N,3),a){u._ensureImageTexture(a,_,c._textureCtx,g.REPEAT);var Y=a._gl_t;if(!Y)return;g.uniform2f(O,_[0],_[1]),g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,Y),g.uniform1i(q,0)}else g.uniform4f(k,i[0]/255,i[1]/255,i[2]/255,l),g.uniform4f(X,i[0]/255,i[1]/255,i[2]/255,s?1:l);g.bindBuffer(g.ARRAY_BUFFER,H),g.drawArrays(g.TRIANGLES,0,e._gl_fill_vcount),g.bindBuffer(g.ARRAY_BUFFER,null),g.bindTexture(g.TEXTURE_2D,null)}},drawShapeLine:function(e,t,r,o,n,i,a,_,l,s,u){var f=this,c=e._layer,g=c._map;if(e._gl_line_vcounts){var h=g._gl,p=g._camera,d=g._canvasOffset,v=g._canvasScale,m=g.getCenter(),x=g.getSize(),y=c._zoomScale||c._scale,E=c._aroundScreen||[],w=h.shapeLineProgram;h.useProgram(w);var G=e._gl_sl_u_mv=e._gl_sl_u_mv||h.getUniformLocation(w,"u_mv"),L=e._gl_sl_u_p=e._gl_sl_u_p||h.getUniformLocation(w,"u_p"),R=e._gl_sl_u_canvas_offset=e._gl_sl_u_canvas_offset||h.getUniformLocation(w,"u_canvas_offset"),b=e._gl_sl_u_canvas_scale=e._gl_sl_u_canvas_scale||h.getUniformLocation(w,"u_canvas_scale"),C=e._gl_sl_u_graphic_offset=e._gl_sl_u_graphic_offset||h.getUniformLocation(w,"u_graphic_offset"),z=e._gl_sl_u_zoom_around=e._gl_sl_u_zoom_around||h.getUniformLocation(w,"u_zoom_around"),T=e._gl_sl_u_zoom_scale=e._gl_sl_u_zoom_scale||h.getUniformLocation(w,"u_zoom_scale"),U=e._gl_sl_u_ignore_rotate=e._gl_sl_u_ignore_rotate||h.getUniformLocation(w,"u_ignore_rotate"),M=e._gl_sl_u_res=e._gl_sl_u_res||h.getUniformLocation(w,"u_res"),D=e._gl_sl_u_center=e._gl_sl_u_center||h.getUniformLocation(w,"u_center"),S=e._gl_sl_u_size=e._gl_sl_u_size||h.getUniformLocation(w,"u_size"),A=e._gl_sl_u_rotate=e._gl_sl_u_rotate||h.getUniformLocation(w,"u_rotate"),P=e._gl_sl_u_shape=e._gl_sl_u_shape||h.getUniformLocation(w,"u_shape"),I=e._gl_sl_u_size_x=e._gl_sl_u_size_x||h.getUniformLocation(w,"u_size_x"),F=e._gl_sl_u_size_y=e._gl_sl_u_size_y||h.getUniformLocation(w,"u_size_y"),V=e._gl_sl_u_offset_x=e._gl_sl_u_offset_x||h.getUniformLocation(w,"u_offset_x"),N=e._gl_sl_u_offset_y=e._gl_sl_u_offset_y||h.getUniformLocation(w,"u_offset_y"),W=e._gl_sl_a_pt=e._gl_sl_a_pt||h.getAttribLocation(w,"a_pt"),O=e._gl_sl_u_color=e._gl_sl_u_color||h.getUniformLocation(w,"u_color");h.uniformMatrix4fv(G,!1,p._mvMatrix),h.uniformMatrix4fv(L,!1,p._pMatrix),h.uniform2f(R,d[0],d[1]),h.uniform2f(b,v[0],v[1]),h.uniform2f(C,t[0]||0,t[1]||0),h.uniform2f(z,E[0]||0,E[1]||0),h.uniform1f(T,y||1),h.uniform1i(U,1),h.uniform1f(M,g._res),h.uniform2f(D,m[0],m[1]),h.uniform2f(S,x[0],x[1]),h.uniform1f(A,g._rotate),"circle"==r?h.uniform1i(P,1):"rect"==r&&h.uniform1i(P,2),h.uniform1f(I,o[0]||0),h.uniform1f(F,o[1]||0),h.uniform1f(V,n[0]||0),h.uniform1f(N,n[1]||0),h.uniform4f(O,i[0]/255,i[1]/255,i[2]/255,a);var q=e._gl_line_vb=e._gl_line_vb||h.createBuffer();f._bufferFloat32Array(h,q,e._gl_line_vs,W,3),h.bindBuffer(h.ARRAY_BUFFER,q),h.lineWidth(_);for(var B,k=0,X=0,H=e._gl_line_vcounts.length;X<H;X++)B=e._gl_line_vcounts[X],B>1&&h.drawArrays(h.LINE_STRIP,k,B),k+=B;h.bindBuffer(h.ARRAY_BUFFER,null)}},drawShapeImage:function(e,t,r,o,n,i){var a=this,_=e._layer,l=_._map;if(12==e._gl_fill_vcount&&r){var s,u,f=l._gl,c=l._camera,g=l._canvasOffset,h=l._canvasScale,p=l.getCenter(),d=l.getSize(),v=_._zoomScale||_._scale,m=_._aroundScreen||[];if(r._loaded&&(a._ensureImageTexture(r,o,l._textureCtx,f.CLAMP_TO_EDGE),s=r._gl_t,s&&(u=r._gl_image_size))){var x=f.shapeImageProgram;f.useProgram(x);var y=e._gl_si_u_mv=e._gl_si_u_mv||f.getUniformLocation(x,"u_mv"),E=e._gl_si_u_p=e._gl_si_u_p||f.getUniformLocation(x,"u_p"),w=e._gl_si_u_canvas_offset=e._gl_si_u_canvas_offset||f.getUniformLocation(x,"u_canvas_offset"),G=e._gl_si_u_canvas_scale=e._gl_si_u_canvas_scale||f.getUniformLocation(x,"u_canvas_scale"),L=e._gl_si_u_graphic_offset=e._gl_si_u_graphic_offset||f.getUniformLocation(x,"u_graphic_offset"),R=e._gl_si_u_zoom_around=e._gl_si_u_zoom_around||f.getUniformLocation(x,"u_zoom_around"),b=e._gl_si_u_zoom_scale=e._gl_si_u_zoom_scale||f.getUniformLocation(x,"u_zoom_scale"),C=e._gl_si_u_ignore_rotate=e._gl_si_u_ignore_rotate||f.getUniformLocation(x,"u_ignore_rotate"),z=e._gl_si_u_res=e._gl_si_u_res||f.getUniformLocation(x,"u_res"),T=e._gl_si_u_center=e._gl_si_u_center||f.getUniformLocation(x,"u_center"),U=e._gl_si_u_size=e._gl_si_u_size||f.getUniformLocation(x,"u_size"),M=e._gl_si_u_rotate=e._gl_si_u_rotate||f.getUniformLocation(x,"u_rotate"),D=e._gl_si_u_size_x=e._gl_si_u_size_x||f.getUniformLocation(x,"u_size_x"),S=e._gl_si_u_size_y=e._gl_si_u_size_y||f.getUniformLocation(x,"u_size_y"),A=e._gl_si_u_offset_x=e._gl_si_u_offset_x||f.getUniformLocation(x,"u_offset_x"),P=e._gl_si_u_offset_y=e._gl_si_u_offset_y||f.getUniformLocation(x,"u_offset_y"),I=e._gl_si_u_image_rotate=e._gl_si_u_image_rotate||f.getUniformLocation(x,"u_image_rotate"),F=e._gl_si_u_texture_size=e._gl_si_u_texture_size||f.getUniformLocation(x,"u_texture_size"),V=e._gl_si_a_pt=e._gl_si_a_pt||f.getAttribLocation(x,"a_pt"),N=e._gl_si_u_sampler=e._gl_si_u_sampler||f.getUniformLocation(x,"u_sampler"),W=(e._gl_si_a_texcoord=e._gl_si_a_texcoord||f.getAttribLocation(x,"a_texcoord"),e._gl_fill_vb=e._gl_fill_vb||f.createBuffer());a._bufferFloat32Array(f,W,e._gl_fill_vs,V,3),f.uniformMatrix4fv(y,!1,c._mvMatrix),f.uniformMatrix4fv(E,!1,c._pMatrix),f.uniform2f(w,g[0],g[1]),f.uniform2f(G,h[0],h[1]),f.uniform2f(L,t[0]||0,t[1]||0),f.uniform2f(R,m[0]||0,m[1]||0),f.uniform1f(b,v||1),f.uniform1i(C,1),f.uniform1f(z,l._res),f.uniform2f(T,p[0],p[1]),f.uniform2f(U,d[0],d[1]),f.uniform1f(M,l._rotate),f.uniform1f(D,o[0]),f.uniform1f(S,o[1]),f.uniform1f(A,n[0]||0),f.uniform1f(P,n[1]||0),f.uniform1f(I,i||0),f.uniform1f(F,u),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,s),f.uniform1i(N,0),f.bindBuffer(f.ARRAY_BUFFER,W),f.drawArrays(f.TRIANGLES,0,e._gl_fill_vcount),f.bindBuffer(f.ARRAY_BUFFER,null),f.bindTexture(f.TEXTURE_2D,null)}}},drawShapeText:function(e,t,r,o,n,i,a,_,l,s){var u=this,f=e._layer,c=f._map;if(12==e._gl_fill_vcount&&void 0!=r){var g,h,p,d,v,m=c._gl,x=c._camera,y=c._canvasOffset,E=c._canvasScale,w=c.getCenter(),G=c.getSize(),L=f._zoomScale||f._scale,R=f._aroundScreen||[],b=o[0],C=e._textMeasure;if(!e._gl_image_data||r&&C!=r){h=c._textureCtx,h.save(),h.font=l+" "+b+"px "+_,h.textBaseline="bottom";var z=h.measureText(r);e._textMeasureWidth=z.width,e._textMeasure=r,v=e._textSize=[z.width,b+2],d=u._calcTextureSize(v[0],v[1]),p=h.canvas,p.width=d,p.height=d,h.fillStyle=i,h.globalAlpha=a,h.font=l+" "+b+"px "+_,h.textBaseline="bottom",h.fillText(r,0,v[1]-1),e._gl_image_data=h.getImageData(0,0,d,d),e._gl_image_size=d,h.restore()}if(!e._gl_t&&e._gl_image_data&&(g=e._gl_t=m.createTexture(),m.bindTexture(m.TEXTURE_2D,g),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,e._gl_image_data),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.generateMipmap(m.TEXTURE_2D),m.bindTexture(m.TEXTURE_2D,null)),g=e._gl_t,g&&(d=e._gl_image_size)){var T=m.shapeImageProgram;m.useProgram(T);var U=e._gl_st_u_mv=e._gl_st_u_mv||m.getUniformLocation(T,"u_mv"),M=e._gl_st_u_p=e._gl_st_u_p||m.getUniformLocation(T,"u_p"),D=e._gl_st_u_canvas_offset=e._gl_st_u_canvas_offset||m.getUniformLocation(T,"u_canvas_offset"),S=e._gl_st_u_canvas_scale=e._gl_st_u_canvas_scale||m.getUniformLocation(T,"u_canvas_scale"),A=e._gl_st_u_graphic_offset=e._gl_st_u_graphic_offset||m.getUniformLocation(T,"u_graphic_offset"),P=e._gl_st_u_zoom_around=e._gl_st_u_zoom_around||m.getUniformLocation(T,"u_zoom_around"),I=e._gl_st_u_zoom_scale=e._gl_st_u_zoom_scale||m.getUniformLocation(T,"u_zoom_scale"),F=e._gl_st_u_ignore_rotate=e._gl_st_u_ignore_rotate||m.getUniformLocation(T,"u_ignore_rotate"),V=e._gl_st_u_res=e._gl_st_u_res||m.getUniformLocation(T,"u_res"),N=e._gl_st_u_center=e._gl_st_u_center||m.getUniformLocation(T,"u_center"),W=e._gl_st_u_size=e._gl_st_u_size||m.getUniformLocation(T,"u_size"),O=e._gl_st_u_rotate=e._gl_st_u_rotate||m.getUniformLocation(T,"u_rotate"),q=e._gl_st_u_size_x=e._gl_st_u_size_x||m.getUniformLocation(T,"u_size_x"),B=e._gl_st_u_size_y=e._gl_st_u_size_y||m.getUniformLocation(T,"u_size_y"),k=e._gl_st_u_offset_x=e._gl_st_u_offset_x||m.getUniformLocation(T,"u_offset_x"),X=e._gl_st_u_offset_y=e._gl_st_u_offset_y||m.getUniformLocation(T,"u_offset_y"),H=e._gl_st_u_image_rotate=e._gl_st_u_image_rotate||m.getUniformLocation(T,"u_image_rotate"),Y=e._gl_st_u_texture_size=e._gl_st_u_texture_size||m.getUniformLocation(T,"u_texture_size"),j=e._gl_st_a_pt=e._gl_st_a_pt||m.getAttribLocation(T,"a_pt"),K=e._gl_st_u_sampler=e._gl_st_u_sampler||m.getUniformLocation(T,"u_sampler"),J=(e._gl_st_a_texcoord=e._gl_st_a_texcoord||m.getAttribLocation(T,"a_texcoord"),e._gl_fill_vb=e._gl_fill_vb||m.createBuffer());u._bufferFloat32Array(m,J,e._gl_fill_vs,j,3),m.uniformMatrix4fv(U,!1,x._mvMatrix),m.uniformMatrix4fv(M,!1,x._pMatrix),m.uniform2f(D,y[0],y[1]),m.uniform2f(S,E[0],E[1]),m.uniform2f(A,t[0],t[1]),m.uniform2f(P,R[0]||0,R[1]||0),m.uniform1f(I,L||1),m.uniform1i(F,1),m.uniform1f(V,c._res),m.uniform2f(N,w[0],w[1]),m.uniform2f(W,G[0],G[1]),m.uniform1f(O,c._rotate),v=e._textSize,m.uniform1f(q,v[0]),m.uniform1f(B,v[1]),"left"==s?(m.uniform1f(k,n[0]||0),m.uniform1f(X,(n[1]||0)-v[1]/2)):"right"==s?(m.uniform1f(k,(n[0]||0)-v[0]),m.uniform1f(X,(n[1]||0)-v[1]/2)):(m.uniform1f(k,(n[0]||0)-v[0]/2),m.uniform1f(X,(n[1]||0)-v[1]/2)),m.uniform1f(H,0),m.uniform1f(Y,d),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,g),m.uniform1i(K,0),m.bindBuffer(m.ARRAY_BUFFER,J),m.drawArrays(m.TRIANGLES,0,e._gl_fill_vcount),m.bindBuffer(m.ARRAY_BUFFER,null),m.bindTexture(m.TEXTURE_2D,null)}}},_calcTextureSize:function(e,t){var r,o,n,i=Math.max(e,t||e);for(r=2,o=8;r<=o;r++){if(n=Math.pow(2,r),n>=i){i=n;break}r==o&&(i=n)}return i},_ensureImageTexture:function(e,t,r,o){var n,i,a,_=this;e&&e._loaded&&(e._gl_image_data||(a=_._calcTextureSize(t[0],t[1]),r.save(),i=r.canvas,i.width=a,i.height=a,r.clearRect(0,0,a,a),r.drawImage(e,0,0,t[0],t[1]),e._gl_image_data=r.getImageData(0,0,a,a),e._gl_image_size=a,r.restore()),!e._gl_t&&e._gl_image_data&&(n=e._gl_t=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,n),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e._gl_image_data),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,o),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)))}},G.Layer.Graphic=G.Layer.Graphic.extend({_update:function(){var e=this;e._draw()},_draw:function(){var e,t,r=this,o=r._map,n=o.getRedrawExtent(),i=r._tree.search(n).sort(r._sortIndex);for(var a in i)e=i[a],t=e.bbox,e._draw&&e._layer&&G.ExtentUtil.overlaps(t,n)&&!e._isVertex&&e._draw();for(var a in i)e=i[a],t=e.bbox,e._draw&&e._layer&&G.ExtentUtil.overlaps(t,n)&&e._isVertex&&e._draw()}}),G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var e=this,t=e._map;t._gl;e.addListener("tileSuccess",t._requestRedraw,t),e.addListener("allLoaded",t._requestRedraw,t)},_destroyContainer:function(){var e=this,t=e._map;t._gl;e.removeListener("tileSuccess",t._requestRedraw,t),e.removeListener("allLoaded",t._requestRedraw,t)},_update:function(){var e=this,t=e._map;if(t._isLoaded()){var r,o,n,i,a,_,l,s,u,f,c,g=e._zoom=e._calcNearestZoom(!0),h=e._calcVisTileInfos(!0),p=(t.getSize(),t.getCenter()),d=e.options,v=d.zoomReses[g],m=d.tileSize,x=t.getDrawSize(),y=1+2*t.options.canvasExpandFactor,E=x[0]*y,w=x[1]*y,L=p[0]-E*v/2,R=p[0]+E*v/2,b=p[1]-w*v/2,C=p[1]+w*v/2,z=[L,b,R,C],T=t.options.maxExtent;e._redrawExtent=z;var U=G.ExtentUtil.intersect(z,T);for(var M in e._tiles)n=e._tiles[M],i=n._info,r=i[0],o=i[1],a=i[2],c=d.zoomReses[a],a!==g&&(e._stopLoadingTile(n),(!d.keepResample||d.opacity<1)&&e._removeTile(M)),_=d.originX+r*m*c,l=d.originX+(r+1)*m*c,s=d.originY-(o+1)*m*c,u=d.originY-o*m*c,f=G.ExtentUtil.overlaps([_,s,l,u],U),f||e._tileInfoExist(i,h)||e._removeTile(M);var D=e._calcTileIndex(p[0],p[1],g);e._sortTileInfos(h,D[0],D[1]),e._addTiles(h),e._draw()}},_draw:function(){var e,t,r,o,n,i,a=this,_=(a._map,a.options),l=a._zoom;for(i in a._tiles)e=a._tiles[i],t=e._info,n=parseInt(t[2]),!e._loaded||n===l||!_.keepResample||_.opacity<1||(r=parseInt(t[0]),o=parseInt(t[1]),a._placeTile(e,r,o,n));for(i in a._tiles)e=a._tiles[i],t=e._info,n=parseInt(t[2]),e._loaded&&n===l&&(r=parseInt(t[0]),o=parseInt(t[1]),a._placeTile(e,r,o,n))},_placeTile:function(e,t,r,o){if(e._loaded){var n=this,i=(G.MathUtil,G.Browser.getPxRatio()),a=(i[0],i[1],n._map),_=a._rotate,l=a._res,s=n.options,u=a.options,f=s.tileSize,c=s.zoomReses[o],g=f*c,h=s.tileEnlarge&&(!!(_%90)||G.Browser.gecko||G.Browser.safari),p=Math.ceil(g/l)+(h?2:0),d=s.originX+t*g,v=s.originY-r*g,m=n._zoomScale||n._scale;n._aroundScreen;if(m&&1!==m&&(p/=m),!(p>4*(f+2)||p<f/8)){var x=p*l,y=p*l;if(u.wrap){var E=0,w=0,L=u.maxExtent,R=n._redrawExtent;if(R&&L){var b=L[2]-L[0];w=Math.floor((R[0]-s.minX)/b)-1,E=Math.ceil((R[2]-s.maxX)/b)+1}for(var C=w;C<=E;C++){var z=d+C*b,T=v;h&&(z-=l,T+=l);var U=[z,T,z+x,T,z+x,T-y,z,T-y];G.GLDrawUtil.drawTile(n,e,U,s.opacity)}}}}},_addTiles:function(e){var t=this;if(0!==e.length){t._numLoad=e.length,t._numLoadSuccess=0,t._numLoadError=0;for(var r,o,n,i,a,_,l,s=t.options,u=(s.zoomReses.length,t.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE),f=0,c=e.length;f<c;f++)o=e[f],n=o[0],i=o[1],a=o[2],l=s.zoomReses[a],_=t._getTileName(n,i,a),r=t._tiles[_],r?r.src==u?+new Date-r._responseTime>s.tileLiveMs&&t._loadTile(r,n,i,a):t._numLoadSuccess++:(r=t._getIdleTile(),t._tiles[_]=r,t._loadTile(r,n,i,a));t._checkAllHandled()}},_clearBgBuffer:function(){var e,t,r,o=this;for(var n in o._tiles)e=o._tiles[n],t=e._info,r=t[2],r!==o._zoom&&o._removeTile(n)},_onTileRemoved:function(e){var t=this,r=t._map,o=r._gl;o.deleteBuffer(e._gl_vb),o.deleteBuffer(e._gl_ib),o.deleteBuffer(e._gl_tcb),o.deleteTexture(e._gl_t),e._gl_vb=null,e._gl_ib=null,e._gl_tcb=null,e._gl_t=null}}),G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(e,t){var r=this;G.Layer.Graphic.prototype.init.call(r,t),r.url=e,r.options=G.Util.merge({},r.options,t),r._lts={},r._gx=r._gy=10},_initContainer:function(){var e=this;G.Layer.Graphic.prototype._initContainer.call(e)},_onAdded:function(){var e=this;e._container||e._initContainer()},_onRemoved:function(){var e=this;e._container&&e._destroyContainer()},_update:function(){var e=this,t=e._map;if(G.Layer.Graphic.prototype._update.call(e),t._isLoaded()){var r=e._zoom=e._calcNearestZoom(!0),o=t.getCenter();e._clearGrids();var n=t._zoomAnim;if(n&&n._playing);else{var i=e._calcVisTileInfos(),a=e._calcTileIndex(o[0],o[1],r);e._sortTileInfos(i,a[0],a[1]),e._setLts(i)}}},_setLts:function(e){var t=this;if(e.length){for(var r,o,n,i,a,_,l=[],s=0,u=e.length;s<u;s++)n=e[s],i=n[0],a=n[1],_=n[2],r=t._getTileName(i,a,_),l.push(r),r in t._lts?(o=t._lts[r],o.loading||o.data||o.ri||t._loadLtI(i,a,_)):t._loadLtI(i,a,_),t._placeLt(r);t._dirtyTileKeys=t._dirtyTileKeys||[];for(r in t._lts)l.indexOf(r)>-1||(t._stopLoadingLt(r),t._dirtyTileKeys.push(r))}},_checkDirtyTiles:function(){var e,t=this,r=t._dirtyTileKeys;if(r&&r.length>0)for(var o=0,n=r.length;o<n;o++)e=r[o],t._removeLt(e);t._dirtyTileKeys=[]},_placeLt:function(e){var t=this,r=t._lts[e];if(r&&r._info&&r.data){var o,n,i,a,_,l,s,u,f,c,g,h,p,d,v,m,x,y,E,w,L=r.data.l;for(o in L){n=L[o],i=Number(n[0]),a=Number(n[1]),_=Number(n[2]),l=Number(n[3]),s=Number(n[4]),u=Number(n[5]),f=n[6],m=[i,a],x="imgs"+o,y=r[x];for(E in y)c=y[E],g=c[0],h=c[1],p=c[2],d=c[3],v=c[4],w=c[5],w||(c[5]=w=new G.Graphic.Point(m,null,{shape:"image",size:[h,p],offset:[d,v],image:g,imageGravity:!!f}),w.addTo(t))}}},_removeLt:function(e){var t=this,r=t._lts[e];if(r&&r._info&&r.data){t._stopLoadingLt(e);var o,n,i,a,_,l=r.data.l;for(o in l){i="imgs"+o,a=r[i];for(_ in a)n=a[_],g=n[5],g&&g.remove()}delete t._lts[e]}},_loadLtI:function(e,t,r){var o=this,n=o._getTileName(e,t,r),i=o._lts[n]=o._lts[n]||{};if(i._info=[e,t,r],""!==i.data){i.loading=!0;var a=o._getTileUrl(e,t,r,{d:"i",i:G.Browser.retina?"@2x":""}),_={};o.options.crossOrigin&&(_.crossOrigin=o.options.crossOrigin);var l={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",header:_,success:function(e,t){i.data=t,o._processLt(n)},error:function(e){404==e.status&&(i.data="")},complete:function(){delete i.ri,i.loading=!1}};o.options.crossOrigin&&(l.responseType="JSON");var s=G.Util.ajax(a,l);i.ri=s}},_processLt:function(e){var t=this,r=t._lts[e],o=r.data;if(o){var n,i,a,_,l,s,u,f,c,g,h,p,d,v,m,x,y,E,w,G,L,R=o.l,b=o.b,C=o.i,z=o.bb,T=t.options.icons||"";for(i in R){if(n=R[i],a=Number(n[0]),_=Number(n[1]),l=n[6],b&&i in b)for(d=b[i],G=0,L=d.length;G<L;G++)v=d[G],s=v[0],u=v[1],f=v[2],c=v[3],g=v[4],h=v[5],0!=h&&z&&(y=z.slice(g,g+h),E="data:image/png;base64,"+y,w="b"+G,r["imgs"+i]=r["imgs"+i]||{},r["imgs"+i][w]=[E,s,u,f,c]);if(C&&i in C)for(m=C[i],G=0,L=m.length;G<L;G++)x=m[G],s=x[0],u=x[1],f=x[2],c=x[3],p=x[4],E=T+p,w="i"+G,r["imgs"+i]=r["imgs"+i]||{},r["imgs"+i][w]=[E,s,u,f,c]}t._checkDirtyTiles(),t._placeLt(e)}},_stopLoadingLt:function(e){var t=this._lts[e],r=G.Util.ajaxCancel;t&&(r(t.ri),t.loading=!1)},_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(e,t,r,o){for(var n,i=this,a=e;a<=r;a++)for(var _=t;_<=o;_++)if(n=a+","+_,i._g[n])return!0;return!1},_markGrids:function(e,t,r,o){for(var n,i=this,a=e;a<=r;a++)for(var _=t;_<=o;_++)n=a+","+_,i._g[n]=!0}}),G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1e3},init:function(e,t){var r=this;G.Layer.Graphic.prototype.init.call(r,t),r.options=G.Util.merge({},r.options,t),r._reqFunc=e,r._loadingKeys={}},onSuccess:function(e){var t=this;"tile"==t.options.mode?t.fireEvent("loadTileSuccess",{extent:e}):t.fireEvent("loadAllSuccess")},onError:function(e){var t=this;"tile"==t.options.mode?t.fireEvent("loadTileError",{extent:e}):t.fireEvent("loadAllError")},onComplete:function(e){var t=this;if("tile"==t.options.mode){var r=e.join(",");delete t._loadingKeys[r],t.fireEvent("loadTileComplete",{extent:e})}else t.fireEvent("loadAllComplete")},_update:function(){var e=this,t=e._map;if(G.Layer.Graphic.prototype._update.call(e),t._isLoaded())if("tile"==e.options.mode){var r=e.count();r>e.options.vacuumCount&&e._vacuum();var o=e._calcVisTileInfos();e._addFts(o)}else e._loadAll()},_addFts:function(e){var t=this;if(0!==e.length){var r,o,n,i,a,_,l,s,u,f=t._loadingKeys,c={};for(r=0,o=e.length;r<o;r++)a=e[r],_=a[0],l=a[1],s=a[2],u=t._calcTileExtent(_,l,s),n=u.join(","),c[n]=u;for(n in f)c[n]||(i=f[n],G.Util.ajaxCancel(i),delete f[n]);for(n in c)u=c[n],t._loadFt(u)}},_loadFt:function(e){var t=this,r=e.join(","),o=t._reqFunc;if(!(r in t._loadingKeys)&&o){var n=o.call(t,e);t._loadingKeys[r]=n,t.fireEvent("loadTileStart",{extent:e})}},_loadAll:function(){var e=this,t="all",r=e._reqFunc;if(!(t in e._loadingKeys)&&r){var o=r.call(e);e._loadingKeys[t]=o,e.fireEvent("loadAllStart")}}}),G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1e3},init:function(e,t){var r=this,o=function(t){var o=e+"/query",n=r.options,i={ak:n.apiKey,where:n.where,outFields:n.outFields,limit:n.limit};t&&(i.geometry=JSON.stringify(t));var a={responseType:"http"===o.slice(0,4).toLowerCase()?"JSONP":"JSON",data:i,success:function(e,o){var i=o.data,a=i.geometryType,_=i.features;if(_){var l,s,u,f,c,g,h,p,d=_.length-1,v=Math.max(0,d-n.limit),m=[];for(l=d;l>=v;l--){s=_[l],u=s.id,f=s.geom,c=s.attrs||{},"Point"==a?m.push(new G.Graphic.Point(f,c)):"Polyline"==a?m.push(new G.Graphic.Polyline(f,c)):"Polygon"==a?m.push(new G.Graphic.Polygon(f,c)):"MultiPoint"==a?m.push(new G.Graphic.MultiPoint(f,c)):"MultiPolyline"==a?m.push(new G.Graphic.MultiPolyline(f,c)):"MultiPolygon"==a&&m.push(new G.Graphic.MultiPolygon(f,c));for(h in m)p=m[h],p&&(g=u+"_"+h,r.get(g)||p.addTo(r,g))}}r.onSuccess(t)},error:function(){r.onError(t)},complete:function(){r.onComplete(t)}};G.Util.ajax(o,a)};G.Layer.FeatureService.prototype.init.call(r,o,t)}}),G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(e,t){var r=this;G.Layer.Graphic.prototype.init.call(r,t),r.url=e},onSuccess:function(e){this.fireEvent("extentSuccess",{extent:e})},onError:function(e){this.fireEvent("extentError",{extent:e})},onComplete:function(e){var t=this;t.fireEvent("extentComplete",{extent:e})},_update:function(){var e=this,t=e._map,r=e._loadRes=t._res,o=e._loadExtent=t.getExtent(),n=e._loadedStatus;if((!n||r!=n[0]||!G.ExtentUtil.equals(o,n[1]))&&(G.Layer.Graphic.prototype._update.call(e),t._isLoaded())){var i=e._req;i&&G.Util.ajaxCancel(i);var a,_,l=e._graphics;for(_ in l)a=l[_],a._dirty=!0;e._loadStep(1)}},_loadStep:function(e){var t=this,r=t.options,o=t._loadRes,n=t._loadExtent,i=r.tolerance*Math.pow(r.stepFactor,r.stepCount-e),a=t.url+"/filter",_={
responseType:"JSON",data:{extent:JSON.stringify(n),excludeExtents:JSON.stringify([]),res:o,cellPixel:i,outFields:r.outFields},success:function(r,o){t._processResult(e,o)},complete:function(){t._req=null}};t._req=G.Util.ajax(a,_)},_processResult:function(e,t){var r=this,o=r.options,n=r._loadRes,i=r._loadExtent,a=o.tolerance*Math.pow(o.stepFactor,o.stepCount-e),_=n*a,l=t.geometryType,s=t.features;if(!s)return r.onError(i),void r.onComplete(i);var u,f,c,g,h,p,d,v,m=s.length-1;for(u=m;u>=0;u--)if(f=s[u],c=f.id,g=f.geom,h=f.attrs||{},"Point"==l)v=new G.Graphic.Point(g,h),r._updateGraphic(_,c,0,v);else if("Polyline"==l)v=new G.Graphic.Polyline(g,h),r._updateGraphic(_,c,0,v);else if("Polygon"==l)v=new G.Graphic.Polygon(g,h),r._updateGraphic(_,c,0,v);else if("MultiPoint"==l)for(p in g.multi)d=g.multi[p],v=new G.Graphic.Point(d,h),r._updateGraphic(_,c,p,v);else if("MultiPolyline"==l)for(p in g.multi)d=g.multi[p],v=new G.Graphic.Polyline(d,h),r._updateGraphic(_,c,p,v);else if("MultiPolygon"==l)for(p in g.multi)d=g.multi[p],v=new G.Graphic.Polygon(d,h),r._updateGraphic(_,c,p,v);e<o.stepCount?r._loadStep(e+1):(r._clearDirty(),r._loadedStatus=[n,i],r.onSuccess(i),r.onComplete(i))},_updateGraphic:function(e,t,r,o){var n=this,i=t+(r?"_"+r:""),a=n.get(i);a?(e<a._res&&(a.updateGeom(o.geom,!0),a._res=e),a._dirty=!1):(o._res=e,o.addTo(n,i))},_clearDirty:function(){var e,t,r=this,o=r._graphics;for(t in o)e=o[t],e._dirty&&e.remove()}}),G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(e,t){var r=this;r.options=G.Util.merge({},r.options,t),r._reqFunc=e,r._loadingKeys={},r._loadedKeys={}},onSuccess:function(e,t){var r=this;r._numLoadSuccess++;var o=parseInt(e[0]),n=parseInt(e[1]),i=parseInt(e[2]),a=r._getTileName(o,n,i);r._loadedKeys[a]=e,r.fireEvent("loadTileSuccess",{tileInfo:e,data:t})},onError:function(e){var t=this;t._numLoadError++,t.fireEvent("loadTileError",{tileInfo:e})},onComplete:function(e){var t=this,r=parseInt(e[0]),o=parseInt(e[1]),n=parseInt(e[2]),i=t._getTileName(r,o,n);delete t._loadingKeys[i],t.fireEvent("loadTileComplete",{tileInfo:e}),t._checkAllHandled()},_update:function(){var e=this,t=e._map;if(t._isLoaded()){var r,o,n,i,a,_,l,s=e._calcVisTileInfos(),u={};for(r=0,o=s.length;r<o;r++)i=s[r],a=i[0],_=i[1],l=i[2],n=e._getTileName(a,_,l),u[n]=i;e._addTiles(u);for(n in e._loadedKeys)u[n]||(i=e._loadedKeys[n],delete e._loadedKeys[n],e.fireEvent("unusedTile",{tileInfo:i}));e._onUpdated()}},_addTiles:function(e){var t,r,o,n=this,i=n._loadingKeys;for(t in i)e[t]||(r=i[t],G.Util.ajaxCancel(r),delete i[t]);n._numLoad=Object.keys(e).length,n._numLoadSuccess=0,n._numLoadError=0;for(t in e)o=e[t],n._loadTile(o);n._checkAllHandled()},_loadTile:function(e){var t=this,r=t._reqFunc,o=parseInt(e[0]),n=parseInt(e[1]),i=parseInt(e[2]),a=t._getTileName(o,n,i);if(!(a in t._loadingKeys)&&r){if(a in t._loadedKeys)return void t._numLoadSuccess++;var _=r.call(t,o,n,i);t._loadingKeys[a]=_,t.fireEvent("loadTileStart",{tileInfo:e})}},_stopLoadingByKey:function(e){var t=this._loadingKeys,r=t[e];r&&(G.Util.ajaxCancel(r),delete t[e])},_checkAllHandled:function(){var e=this;e._numLoad==e._numLoadSuccess+e._numLoadError&&e.fireEvent("allLoaded")},_onUpdated:function(){}}),G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var e=this,t=e._layer._map;e._resGl=null,t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null;var o,n,i,a=e._fakeLineGraphics||[];for(o=0,n=a.length;o<n;o++)i=a[o],r.deleteBuffer(i._gl_line_vb),i._gl_line_vb=null;t&&t._requestRedraw()},_onGeomUpdated:function(){var e=this;e._resDraw=null,e._resGl=null;var t=e._layer;if(t){var r=t._map;r&&(e._updateGeomDraw(r._res),e._ensureGl())}},_ensureGl:function(){var e=this,t=e._layer;if(t){var r=t._map;if(r&&e._resGl!=r._res){var o=e._geomDraw;if(o){var n,i,a,_,l,s,u,f,c;for(l=o[0],f=[],u=null,a=0,_=l.length;a<_;a++)s=l[a],u&&u[0]==s[0]&&u[1]==s[1]||a==_-1&&s[0]==l[0][0]&&s[1]==l[0][1]||(f.push(new poly2tri.Point(s[0],s[1])),u=s);var g=new poly2tri.SweepContext(f);for(n=1,i=o.length;n<i;n++){for(l=o[n],c=[],u=null,a=0,_=l.length;a<_;a++)s=l[a],u&&u[0]==s[0]&&u[1]==s[1]||a==_-1&&s[0]==l[0][0]&&s[1]==l[0][1]||(c.push(new poly2tri.Point(s[0],s[1])),u=s);g.addHole(c)}try{g.triangulate()}catch(h){}var p,d,v=g.getTriangles(),m=[];for(n=0,i=v.length;n<i;n++)for(p=v[n],a=0;a<3;a++)d=p.getPoint(a),m.push(d.x),m.push(d.y);e._gl_fill_vs=new Float32Array(m),e._gl_fill_vcount=m.length/2;var x,y,E=e._fakeLineGraphics=[];for(n=0,i=o.length;n<i;n++){for(l=o[n],x={},y=[],a=0,_=l.length;a<_;a++)s=l[a],y.push(s[0]),y.push(s[1]);s=l[0],y.push(s[0]),y.push(s[1]),x._gl_line_vs=new Float32Array(y),x._gl_line_vcounts=[y.length/2],E.push(x)}e._resGl=r._res}}}},_draw:function(){var e=this,t=e.options,r=e._layer,o=r._map;if(e._updateGeomDraw(o._res),e._ensureGl(),e._geomDraw&&e._fakeLineGraphics)for(var n=e.bbox,i=(n[0]+n[2])/2,a=(n[1]+n[3])/2,_=o._calcWrapPointRange([i,a])||[0,0],l=o.options.maxExtent,s=l[2]-l[0],u=_[0];u<=_[1];u++){var f=[u*s,0];if(t.fill)if(t.fillImage){var c=G.Browser.getImageSrc(t.fillImage),g=G.DomUtil.getImgElement(c,function(){o._requestRedraw()},null,"*");if(g._loaded){var h=t.fillImageSize;G.GLDrawUtil.drawFill(e,f,null,g,h,t.fillOpacity)}}else G.GLDrawUtil.drawFill(e,f,G.Util.colorRgb(t.fillColor),null,null,t.fillOpacity);if(t.outline||e._mouseOver||e._editing){var p,d,v,m=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,x=t.outlineCap,y=t.outlineJoin,E=(t.outline?t.outlineWidth:0)+(e._mouseOver?t.lineHighlightWiden:0),w=t.outlineOpacity,L=t.outlineDashArray,R=e._fakeLineGraphics;for(p=0,d=R.length;p<d;p++)v=R[p],v._layer=r,G.GLDrawUtil.drawLine(v,f,G.Util.colorRgb(m),w,E,x,y,L)}}},_drawMask:function(){var e=this,t=e._map,r=t._maskCtx;e._updateGeomDraw(t._res);for(var o,n,i,a=e._geomDraw,_=t._canvasOffset,l=e.bbox,s=(l[0]+l[2])/2,u=(l[1]+l[3])/2,f=t._calcWrapPointRange([s,u])||[0,0],c=t.options.maxExtent,g=c[2]-c[0],h=f[0];h<=f[1];h++){var p=[h*g,0];r.beginPath();for(var d=0,v=a.length;d<v;d++){n=a[d];for(var m=0,x=n.length;m<x;m++)i=n[m],i=t.toScreen([i[0]+p[0],i[1]]),o=0===m?"moveTo":"lineTo",r[o](i[0]+_[0],i[1]+_[1]);i=n[0],i=t.toScreen([i[0]+p[0],i[1]]),r.lineTo(i[0]+_[0],i[1]+_[1])}r.fill()}},_onStartEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(i in r.DOWN)t.addListener(r.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,r=this,o=r._layer._map,n=r.virtualMouse;for(e in n.DOWN)t=n.DOWN[e],o.removeListener(t,r._onVertexDragStart,r),o.removeListener(n.MOVE[t],r._onVertexDrag,r),o.removeListener(n.UP[t],r._onVertexDragEnd,r);r._removeVertexes(),G.DomUtil.removeClass(o._layersFrame,"g-edit"),o._requestRedraw()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null,r.deleteBuffer(e._gl_line_vb),e._gl_line_vb=null,t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.geom;if(t){var r,o=t[0],n=t[1],i=[],a=[],_=48;for(r=0;r<_;r++)i.push(o),i.push(n),i.push(-1),i.push(o),i.push(n),i.push(r/_),i.push(o),i.push(n),i.push((r+1)/_),a.push(o),a.push(n),a.push(r/_);a.push(o),a.push(n),a.push(0),e._gl_fill_vs=new Float32Array(i),e._gl_fill_vcount=i.length/3,e._gl_line_vs=new Float32Array(a),e._gl_line_vcounts=[a.length/3]}},_draw:function(){var e=this,t=e.options,r=e._layer,o=r._map,n=e.geom[2]/o._res*2;if(n)for(var i=o._calcWrapPointRange(e.geom)||[0,0],a=o.options.maxExtent,_=a[2]-a[0],l=i[0];l<=i[1];l++){var s=[l*_,0];if(t.fill)if(t.fillImage){var u=G.Browser.getImageSrc(t.fillImage),f=G.DomUtil.getImgElement(u,function(){o._requestRedraw()},null,"*");if(f._loaded){var c=t.fillImageSize;G.GLDrawUtil.drawShapeFill(e,s,"circle",[n,0],[0,0],null,f,c,t.fillOpacity)}}else G.GLDrawUtil.drawShapeFill(e,s,"circle",[n,0],[0,0],G.Util.colorRgb(t.fillColor),null,null,t.fillOpacity,t.gradual);if(t.outline||e._mouseOver){var g=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,h=e._mouseOver?t.outlineWidth+t.lineHighlightWiden:t.outlineWidth,p=t.outlineOpacity,d=t.outlineDashArray;G.GLDrawUtil.drawShapeLine(e,s,"circle",[n,0],[0,0],G.Util.colorRgb(g),p,h,null,null,d)}}},_drawMask:function(){for(var e=this,t=e._map,r=t._maskCtx,o=t._res,n=e.geom,i=n[0],a=n[1],_=n[2],l=_/o,s=t._canvasOffset,u=t._calcWrapPointRange(n)||[0,0],f=t.options.maxExtent,c=f[2]-f[0],g=u[0];g<=u[1];g++){var h=t.toScreen([i+g*c,a]);h[0]+=s[0],h[1]+=s[1],r.beginPath(),r.arc(h[0],h[1],l,0,2*Math.PI,!1),r.fill()}},_onStartEdit:function(){var e=this,t=e._layer,r=t._map,o=e.virtualMouse;for(var n in o.DOWN)r.addListener(o.DOWN[n],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(var o in r.DOWN)t.removeListener(r.DOWN[o],e._onVertexDragStart,e);e._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Group=G.Graphic.Group.extend({_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.MultiPoint=G.Graphic.MultiPoint.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null,r.deleteBuffer(e._gl_line_vb),e._gl_line_vb=null,t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.options,r=t.shape,o=e.geom;if(o&&o.m){var n,i,a,_,l,s=o.m,u=[],f=[],c=0;e._gl_line_vcounts=e._gl_line_vcounts||[];for(var g=0,h=s.length;g<h;g++){if(n=s[g],i=n[0],a=n[1],"rect"==r)e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,1),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,1),e._pushVertex(f,i,a,1),e._pushVertex(f,i,a,2),e._pushVertex(f,i,a,3),e._pushVertex(f,i,a,4),e._pushVertex(f,i,a,1);else if("image"==r)e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,1),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,1);else if("text"==r)e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,1),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,2),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,3),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,0),e._pushVertex(u,i,a,4),e._pushVertex(u,i,a,1);else{for(_=0,l=48;_<l;_++)e._pushVertex(u,i,a,-1),e._pushVertex(u,i,a,_/l),e._pushVertex(u,i,a,(_+1)/l),e._pushVertex(f,i,a,_/l);e._pushVertex(f,i,a,0)}e._gl_line_vcounts[g]=f.length/3-c,c=f.length/3}e._gl_fill_vs=new Float32Array(u),e._gl_fill_vcount=u.length/3,e._gl_line_vs=new Float32Array(f)}},_pushVertex:function(e,t,r,o){e.push(t),e.push(r),e.push(o)},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=t.shape,i=t.size,a=t.offset,_=t.fillColor,l=t.fillOpacity,s=t.gradual,u=e.bbox,f=(u[0]+u[2])/2,c=(u[1]+u[3])/2,g=o._calcWrapPointRange([f,c])||[0,0],h=o.options.maxExtent,p=h[2]-h[0],d=g[0];d<=g[1];d++){var v=[d*p,0];if(t.fill)if("rect"==n)G.GLDrawUtil.drawShapeFill(e,v,"rect",i,a,G.Util.colorRgb(_),null,null,l,s);else if("image"==n){var m=G.Browser.getImageSrc(t.image),x=G.DomUtil.getImgElement(m,function(){o._requestRedraw()});if(x._loaded){var y=t.imageRotate;t.imageGravity||(y+=o._rotate),G.GLDrawUtil.drawShapeImage(e,v,x,i,a,y)}}else"text"==n?G.GLDrawUtil.drawShapeText(e,v,t.text,i,a,_,l,t.textFont,t.textStyle,t.textAlign):G.GLDrawUtil.drawShapeFill(e,v,"circle",i,a,G.Util.colorRgb(_),null,null,l,s);if(t.outline||e._mouseOver||e._editing){var E=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,w=e._mouseOver?t.outlineWidth+t.lineHighlightWiden:t.outlineWidth,L=t.outlineOpacity,R=t.outlineDashArray;"rect"==n?G.GLDrawUtil.drawShapeLine(e,v,"rect",i,a,G.Util.colorRgb(E),L,w,null,null,R):"image"==n||"text"==n||G.GLDrawUtil.drawShapeLine(e,v,"circle",i,a,G.Util.colorRgb(E),L,w,null,null,R)}}},_onStartEdit:function(){var e=this,t=e._layer,r=t._map,o=e.virtualMouse;for(var n in o.DOWN)r.addListener(o.DOWN[n],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(var o in r.DOWN)t.removeListener(r.DOWN[o],e._onVertexDragStart,e);e._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer;if(t){var r=t._map,o=G.DomUtil,n=r._handlers.Drag;n&&!n._dragging&&!e.options.allowPan,r._requestRedraw(),e._isVertex?o.addClass(r._layersFrame,"g-edit"):o.addClass(r._layersFrame,"g-clickable")}},_onMouseOut:function(){var e=this,t=e._layer;if(t){var r=t._map,o=G.DomUtil,n=r._handlers.Drag;n&&!n._dragging,r._requestRedraw(),e._isVertex?o.removeClass(r._layersFrame,"g-edit"):o.removeClass(r._layersFrame,"g-clickable")}}}),G.Graphic.MultiPolygon=G.Graphic.MultiPolygon.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null;var o,n,i,a=e._fakeLineGraphics||[];for(o=0,n=a.length;o<n;o++)i=a[o],r.deleteBuffer(i._gl_line_vb),i._gl_line_vb=null;t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.geom;if(t&&t.m){for(var r,o,n,i,a,_,l,s,u,f,c=t.m,g=[],h=e._fakeLineGraphics=[],p=0,d=c.length;p<d;p++){for(f=c[p],a=f[0],s=[],l=null,n=0,i=a.length;n<i;n++)_=a[n],l&&l[0]==_[0]&&l[1]==_[1]||n==i-1&&_[0]==a[0][0]&&_[1]==a[0][1]||(s.push(new poly2tri.Point(_[0],_[1])),l=_);var v=new poly2tri.SweepContext(s);for(r=1,o=f.length;r<o;r++){for(a=f[r],u=[],l=null,n=0,i=a.length;n<i;n++)_=a[n],l&&l[0]==_[0]&&l[1]==_[1]||n==i-1&&_[0]==a[0][0]&&_[1]==a[0][1]||(u.push(new poly2tri.Point(_[0],_[1])),l=_);v.addHole(u)}try{v.triangulate()}catch(m){}var x,y,E=v.getTriangles();for(r=0,o=E.length;r<o;r++)for(x=E[r],n=0;n<3;n++)y=x.getPoint(n),g.push(y.x),g.push(y.y);var w,G;for(r=0,o=f.length;r<o;r++){for(a=f[r],w={},G=[],n=0,i=a.length;n<i;n++)_=a[n],G.push(_[0]),G.push(_[1]);_=a[0],G.push(_[0]),G.push(_[1]),w._gl_line_vs=new Float32Array(G),w._gl_line_vcounts=[G.length/2],h.push(w)}}e._gl_fill_vs=new Float32Array(g),e._gl_fill_vcount=g.length/2}},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=e.bbox,i=(n[0]+n[2])/2,a=(n[1]+n[3])/2,_=o._calcWrapPointRange([i,a])||[0,0],l=o.options.maxExtent,s=l[2]-l[0],u=_[0];u<=_[1];u++){var f=[u*s,0];if(t.fill)if(t.fillImage){var c=G.Browser.getImageSrc(t.fillImage),g=G.DomUtil.getImgElement(c,function(){o._requestRedraw()},null,"*");if(g._loaded){var h=t.fillImageSize;G.GLDrawUtil.drawFill(e,f,null,g,h,t.fillOpacity)}}else G.GLDrawUtil.drawFill(e,f,G.Util.colorRgb(t.fillColor),null,null,t.fillOpacity);if(t.outline||e._mouseOver||e._editing){var p,d,v,m=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,x=t.outlineCap,y=t.outlineJoin,E=(t.outline?t.outlineWidth:0)+(e._mouseOver?t.lineHighlightWiden:0),w=t.outlineOpacity,L=t.outlineDashArray,R=e._fakeLineGraphics;for(p=0,d=R.length;p<d;p++)v=R[p],v._layer=r,G.GLDrawUtil.drawLine(v,f,G.Util.colorRgb(m),w,E,x,y,L)}}},_drawMask:function(){var e,t,r,o,n=this,i=n._map,a=i._maskCtx,_=n.geom.m,l=i._canvasOffset,s=n.bbox,u=(s[0]+s[2])/2,f=(s[1]+s[3])/2,c=i._calcWrapPointRange([u,f])||[0,0],g=i.options.maxExtent,h=g[2]-g[0];a.beginPath();for(var p=c[0];p<=c[1];p++)for(var d=0,v=_.length;d<v;d++){e=_[d];for(var m=0,x=e.length;m<x;m++){r=e[m];for(var y=0,E=r.length;y<E;y++)o=r[y],o=i.toScreen([o[0]+p*h,o[1]]),t=0===y?"moveTo":"lineTo",a[t](o[0]+l[0],o[1]+l[1]);o=r[0],o=i.toScreen([o[0]+p*h,o[1]]),a.lineTo(o[0]+l[0],o[1]+l[1])}}a.fill()},_onStartEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(i in r.DOWN)t.addListener(r.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,r=this,o=r._layer._map,n=r.virtualMouse;for(e in n.DOWN)t=n.DOWN[e],o.removeListener(t,r._onVertexDragStart,r),o.removeListener(n.MOVE[t],r._onVertexDrag,r),o.removeListener(n.UP[t],r._onVertexDragEnd,r);r._removeVertexes(),G.DomUtil.removeClass(o._layersFrame,"g-edit"),o._requestRedraw()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.MultiPolyline=G.Graphic.MultiPolyline.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_line_vb),e._gl_line_vb=null,t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.geom;if(t&&t.m){var r,o,n=t.m,i=[];e._gl_line_vcounts=e._gl_line_vcounts||[];for(var a=0,_=n.length;a<_;a++){r=n[a];for(var l=0,s=r.length;l<s;l++)o=r[l],i.push(o[0]),i.push(o[1]);e._gl_line_vcounts[a]=r.length}e._gl_line_vs=new Float32Array(i)}},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=e._editing?t.lineHighlightColor:t.lineColor,i=G.Util.colorRgb(n),a=t.lineOpacity,_=e._mouseOver?t.lineWidth+t.lineHighlightWiden:t.lineWidth,l=t.lineCap,s=t.lineJoin,u=t.lineDashArray,f=e.bbox,c=(f[0]+f[2])/2,g=(f[1]+f[3])/2,h=o._calcWrapPointRange([c,g])||[0,0],p=o.options.maxExtent,d=p[2]-p[0],v=h[0];v<=h[1];v++){var m=[v*d,0];G.GLDrawUtil.drawLine(e,m,i,a,_,l,s,u)}},_onStartEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(i in r.DOWN)t.addListener(r.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,r=this,o=r._layer._map,n=r.virtualMouse;for(e in n.DOWN)t=n.DOWN[e],o.removeListener(t,r._onVertexDragStart,r),o.removeListener(n.MOVE[t],r._onVertexDrag,r),o.removeListener(n.UP[t],r._onVertexDragEnd,r);r._removeVertexes(),G.DomUtil.removeClass(o._layersFrame,"g-edit"),o._requestRedraw()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null,r.deleteBuffer(e._gl_line_vb),e._gl_line_vb=null,t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.options,r=t.shape,o=e.geom;if(o){var n,i,a=o[0],_=o[1],l=[],s=[];if("rect"==r)e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,1),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,1),e._pushVertex(s,a,_,1),e._pushVertex(s,a,_,2),e._pushVertex(s,a,_,3),e._pushVertex(s,a,_,4),e._pushVertex(s,a,_,1);else if("image"==r)e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,1),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,1);else if("text"==r)e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,1),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,2),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,3),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,0),e._pushVertex(l,a,_,4),e._pushVertex(l,a,_,1);else{for(n=0,i=48;n<i;n++)e._pushVertex(l,a,_,-1),e._pushVertex(l,a,_,n/i),e._pushVertex(l,a,_,(n+1)/i),e._pushVertex(s,a,_,n/i);e._pushVertex(s,a,_,0)}e._gl_fill_vs=new Float32Array(l),e._gl_fill_vcount=l.length/3,e._gl_line_vs=new Float32Array(s),e._gl_line_vcounts=[s.length/3]}},_pushVertex:function(e,t,r,o){e.push(t),e.push(r),e.push(o)},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=t.shape,i=t.size,a=t.offset,_=t.fillColor,l=t.fillOpacity,s=t.gradual,u=o._calcWrapPointRange(e.geom)||[0,0],f=o.options.maxExtent,c=f[2]-f[0],g=u[0];g<=u[1];g++){var h=[g*c,0];if(t.fill)if("rect"==n)G.GLDrawUtil.drawShapeFill(e,h,"rect",i,a,G.Util.colorRgb(_),null,null,l,s);else if("image"==n){var p=G.Browser.getImageSrc(t.image),d=G.DomUtil.getImgElement(p,function(){o._requestRedraw()});if(d._loaded){var v=t.imageRotate;t.imageGravity||(v+=o._rotate),G.GLDrawUtil.drawShapeImage(e,h,d,i,a,v)}}else"text"==n?G.GLDrawUtil.drawShapeText(e,h,t.text,i,a,_,l,t.textFont,t.textStyle,t.textAlign):G.GLDrawUtil.drawShapeFill(e,h,"circle",i,a,G.Util.colorRgb(_),null,null,l,s);if(t.outline||e._mouseOver||e._editing){var m=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,x=e._mouseOver?t.outlineWidth+t.lineHighlightWiden:t.outlineWidth,y=t.outlineOpacity,E=t.outlineDashArray;"rect"==n?G.GLDrawUtil.drawShapeLine(e,h,"rect",i,a,G.Util.colorRgb(m),y,x,null,null,E):"image"==n||"text"==n||G.GLDrawUtil.drawShapeLine(e,h,"circle",i,a,G.Util.colorRgb(m),y,x,null,null,E)}}},_onStartEdit:function(){var e=this,t=e._layer,r=t._map,o=e.virtualMouse;for(var n in o.DOWN)r.addListener(o.DOWN[n],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(var o in r.DOWN)t.removeListener(r.DOWN[o],e._onVertexDragStart,e);e._removeVertexes()},_onMouseOver:function(){var e=this,t=e._layer;if(t){var r=t._map,o=G.DomUtil,n=r._handlers.Drag;n&&!n._dragging&&!e.options.allowPan,r._requestRedraw(),e._isVertex?o.addClass(r._layersFrame,"g-edit"):o.addClass(r._layersFrame,"g-clickable")}},_onMouseOut:function(){var e=this,t=e._layer;if(t){var r=t._map,o=G.DomUtil,n=r._handlers.Drag;n&&!n._dragging,r._requestRedraw(),e._isVertex?o.removeClass(r._layersFrame,"g-edit"):o.removeClass(r._layersFrame,"g-clickable")}}}),G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_fill_vb),e._gl_fill_vb=null;var o,n,i,a=e._fakeLineGraphics||[];for(o=0,n=a.length;o<n;o++)i=a[o],r.deleteBuffer(i._gl_line_vb),i._gl_line_vb=null;t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.geom;if(t){var r,o,n,i,a,_,l,s,u;for(a=t[0],s=[],l=null,n=0,i=a.length;n<i;n++)_=a[n],l&&l[0]==_[0]&&l[1]==_[1]||n==i-1&&_[0]==a[0][0]&&_[1]==a[0][1]||(s.push(new poly2tri.Point(_[0],_[1])),l=_);var f=new poly2tri.SweepContext(s);for(r=1,o=t.length;r<o;r++){for(a=t[r],u=[],l=null,n=0,i=a.length;n<i;n++)_=a[n],l&&l[0]==_[0]&&l[1]==_[1]||n==i-1&&_[0]==a[0][0]&&_[1]==a[0][1]||(u.push(new poly2tri.Point(_[0],_[1])),l=_);f.addHole(u)}try{f.triangulate()}catch(c){}var g,h,p=f.getTriangles(),d=[];for(r=0,o=p.length;r<o;r++)for(g=p[r],n=0;n<3;n++)h=g.getPoint(n),d.push(h.x),d.push(h.y);e._gl_fill_vs=new Float32Array(d),e._gl_fill_vcount=d.length/2;var v,m,x=e._fakeLineGraphics=[];for(r=0,o=t.length;r<o;r++){for(a=t[r],v={},m=[],n=0,i=a.length;n<i;n++)_=a[n],m.push(_[0]),m.push(_[1]);_=a[0],m.push(_[0]),m.push(_[1]),v._gl_line_vs=new Float32Array(m),v._gl_line_vcounts=[m.length/2],x.push(v)}}},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=e.bbox,i=(n[0]+n[2])/2,a=(n[1]+n[3])/2,_=o._calcWrapPointRange([i,a])||[0,0],l=o.options.maxExtent,s=l[2]-l[0],u=_[0];u<=_[1];u++){var f=[u*s,0];if(t.fill)if(t.fillImage){var c=G.Browser.getImageSrc(t.fillImage),g=G.DomUtil.getImgElement(c,function(){o._requestRedraw()},null,"*");if(g._loaded){var h=t.fillImageSize;G.GLDrawUtil.drawFill(e,f,null,g,h,t.fillOpacity)}}else G.GLDrawUtil.drawFill(e,f,G.Util.colorRgb(t.fillColor),null,null,t.fillOpacity);if(t.outline||e._mouseOver||e._editing){var p,d,v,m=e._editing?t.lineHighlightColor:t.outline?t.outlineColor:t.fillColor,x=t.outlineCap,y=t.outlineJoin,E=(t.outline?t.outlineWidth:0)+(e._mouseOver?t.lineHighlightWiden:0),w=t.outlineOpacity,L=t.outlineDashArray,R=e._fakeLineGraphics;for(p=0,d=R.length;p<d;p++)v=R[p],v._layer=r,G.GLDrawUtil.drawLine(v,f,G.Util.colorRgb(m),w,E,x,y,L)}}},_drawMask:function(){for(var e,t,r,o=this,n=o._map,i=n._maskCtx,a=o.geom,_=n._canvasOffset,l=o.bbox,s=(l[0]+l[2])/2,u=(l[1]+l[3])/2,f=n._calcWrapPointRange([s,u])||[0,0],c=n.options.maxExtent,g=c[2]-c[0],h=f[0];h<=f[1];h++){var p=[h*g,0];i.beginPath();for(var d=0,v=a.length;d<v;d++){t=a[d];for(var m=0,x=t.length;m<x;m++)r=t[m],r=n.toScreen([r[0]+p[0],r[1]]),e=0===m?"moveTo":"lineTo",i[e](r[0]+_[0],r[1]+_[1]);r=t[0],r=n.toScreen([r[0]+p[0],r[1]]),i.lineTo(r[0]+_[0],r[1]+_[1])}i.fill()}},_onStartEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(i in r.DOWN)t.addListener(r.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,r=this,o=r._layer._map,n=r.virtualMouse;for(e in n.DOWN)t=n.DOWN[e],o.removeListener(t,r._onVertexDragStart,r),o.removeListener(n.MOVE[t],r._onVertexDrag,r),o.removeListener(n.UP[t],r._onVertexDragEnd,r);r._removeVertexes(),G.DomUtil.removeClass(o._layersFrame,"g-edit"),o._requestRedraw()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var e=this,t=e._layer._map;e._ensureGl(),t&&t._requestRedraw()},_onRemoved:function(){var e=this,t=e._layer._map,r=t._gl;r.deleteBuffer(e._gl_line_vb),e._gl_line_vb=null,t&&t._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var e=this,t=e.geom;if(t&&!(t.length<2)){var r,o,n,i=[];for(r=0,o=t.length;r<o;r++)n=t[r],i.push(n[0]),i.push(n[1]);e._gl_line_vs=new Float32Array(i),e._gl_line_vcounts=[t.length]}},_draw:function(){for(var e=this,t=e.options,r=e._layer,o=r._map,n=e._editing?t.lineHighlightColor:t.lineColor,i=G.Util.colorRgb(n),a=t.lineOpacity,_=e._mouseOver?t.lineWidth+t.lineHighlightWiden:t.lineWidth,l=t.lineCap,s=t.lineJoin,u=t.lineDashArray,f=e.bbox,c=(f[0]+f[2])/2,g=(f[1]+f[3])/2,h=o._calcWrapPointRange([c,g])||[0,0],p=o.options.maxExtent,d=p[2]-p[0],v=h[0];v<=h[1];v++){var m=[v*d,0];G.GLDrawUtil.drawLine(e,m,i,a,_,l,s,u)}},_onStartEdit:function(){var e=this,t=e._layer._map,r=e.virtualMouse;for(i in r.DOWN)t.addListener(r.DOWN[i],e._onVertexDragStart,e);e._refreshVertexes()},_onEndEdit:function(){var e,t,r=this,o=r._layer._map,n=r.virtualMouse;for(e in n.DOWN)t=n.DOWN[e],o.removeListener(t,r._onVertexDragStart,r),o.removeListener(n.MOVE[t],r._onVertexDrag,r),o.removeListener(n.UP[t],r._onVertexDragEnd,r);r._removeVertexes(),G.DomUtil.removeClass(o._layersFrame,"g-edit"),o._requestRedraw()},_onMouseOver:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging&&!e.options.allowPan,t._requestRedraw(),G.DomUtil.addClass(t._layersFrame,"g-clickable")},_onMouseOut:function(){var e=this,t=e._layer._map,r=t._handlers.Drag;r&&!r._dragging,t._requestRedraw(),G.DomUtil.removeClass(t._layersFrame,"g-clickable")}}),G.Map=G.Map.extend({print:function(e,t){var r=this,o=G.DomUtil,n=G.Browser.getCanvasRatio(),i=r.getSize(),a=i[0],_=i[1],l=e||a,s=t||_,u=l/a,f=s/_,c=Math.max(u,f),g=r._gl.canvas,h=g.width/n[0],p=g.height/n[1],d=o.create("canvas");return d.width=l,d.height=s,d.getContext("2d").drawImage(g,(l-h*c)/2,(s-p*c)/2,h*c,p*c),d.toDataURL()},_initAddition:function(){var e,t,r=this,o=G.DomUtil,n=["webgl","experimental-webgl"];for(e=0,t=n.length;e<t&&!r._gl;e++)gl=r._gl=o.create("canvas").getContext(n[e],{alpha:!1,preserveDrawingBuffer:!0});r._textureCtx=o.create("canvas").getContext("2d"),r._initGL(),r._onScreenCtx=o.create("canvas","g-layer",r._layersFrame).getContext("2d"),r._snapshotCtx=o.create("canvas").getContext("2d"),r._maskCtx=o.create("canvas").getContext("2d"),r._mode="webgl"},_initGL:function(){var e=this,t=e._gl;if(t){var r=G.GLShaderUtil,o=r.compile(t,t.VERTEX_SHADER,r.TILE_VS),n=r.compile(t,t.FRAGMENT_SHADER,r.TILE_FS);t.tileProgram=r.genProgram(t,o,n);var i=r.compile(t,t.VERTEX_SHADER,r.PT_VS),a=r.compile(t,t.FRAGMENT_SHADER,r.PT_FS);t.ptProgram=r.genProgram(t,i,a);var _=r.compile(t,t.VERTEX_SHADER,r.LINE_VS),l=r.compile(t,t.FRAGMENT_SHADER,r.LINE_FS);t.lineProgram=r.genProgram(t,_,l);var s=r.compile(t,t.VERTEX_SHADER,r.FILL_VS),u=r.compile(t,t.FRAGMENT_SHADER,r.FILL_FS);t.fillProgram=r.genProgram(t,s,u);var f=r.compile(t,t.VERTEX_SHADER,r.SHAPE_FILL_VS),c=r.compile(t,t.FRAGMENT_SHADER,r.SHAPE_FILL_FS);t.shapeFillProgram=r.genProgram(t,f,c);var g=r.compile(t,t.VERTEX_SHADER,r.SHAPE_LINE_VS),h=r.compile(t,t.FRAGMENT_SHADER,r.SHAPE_LINE_FS);t.shapeLineProgram=r.genProgram(t,g,h);var p=r.compile(t,t.VERTEX_SHADER,r.SHAPE_IMAGE_VS),d=r.compile(t,t.FRAGMENT_SHADER,r.SHAPE_IMAGE_FS);t.shapeImageProgram=r.genProgram(t,p,d),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.flush()}},_redrawSnapshot:function(e,t,r){var o,n,i,a,_,l,s,u=this,f=G.Browser.getCanvasRatio(),c=u._onScreenCtx.canvas,g=c.width/(f[0]||1),h=c.height/(f[1]||1),p=G.Browser.getPxRatio(),d=p[0],v=p[1],m=u._center,x=u._rotate,y=u._res,E=x-t,w=y/r,L=u._onScreenCtx;o=-g/2,n=-h/2,t&&(i=G.MathUtil.rotateVector([o,n],-t),o=i[0],n=i[1]),a=o*r*d+e[0],_=-n*r*v+e[1],o=(a-m[0])/y/d,n=-(_-m[1])/y/v,x&&(i=G.MathUtil.rotateVector([o,n],x),o=i[0],n=i[1]),l=g/2+o,s=h/2+n,u._clearCanvas(L),L.save(),L.translate(l,s),L.rotate(E/G.MathUtil.DEGREE_PER_RADIAN),L.drawImage(u._snapshotCtx.canvas,0,0,g/w,h/w),L.restore()},_redraw:function(){var e=this,t=e._gl;if(t){var r=e._zoomAnim,o=e._rotateAnim,n=e._handlers.Pinch;if(!e.options.canvasAnimRedraw&&r&&r._playing)return void e._redrawSnapshot(r._startCenter,e._rotate,r._startRes);if(!e.options.canvasAnimRedraw&&o&&o._playing)return void e._redrawSnapshot(e._center,o._startRotate,e._res);if(!e.options.canvasAnimRedraw&&n&&n._pinching)return void e._redrawSnapshot(n._startCenter,n._startRotate,n._startRes);e._clearGlCanvas();var i,a,_;for(i in e._layerOrder)a=e._layerOrder[i],_=e._layers[a],_.isVisible()&&_._draw();t.flush();var l=G.Browser.getCanvasRatio(),s=e._onScreenCtx.canvas;w=s.width/(l[0]||1),h=s.height/(l[1]||1);try{e._clearCanvas(e._onScreenCtx),e._onScreenCtx.drawImage(e._gl.canvas,0,0,w,h)}catch(u){}try{e._onScreenCtx.drawImage(e._maskCtx.canvas,0,0)}catch(u){}e._drawMask(),e.fireEvent("redraw")}},_update:function(){var e=this,t=e._gl;if(t){e._clearGlCanvas();var r;for(var o in e._layers)r=e._layers[o],r.isVisible()&&r._update();t.flush();var n=G.Browser.getCanvasRatio(),i=e._onScreenCtx.canvas;
w=i.width/(n[0]||1),h=i.height/(n[1]||1);try{e._clearCanvas(e._onScreenCtx),e._onScreenCtx.drawImage(e._gl.canvas,0,0,w,h)}catch(a){}e._drawMask();try{e._onScreenCtx.drawImage(e._maskCtx.canvas,0,0)}catch(a){}e.fireEvent("update")}},_drawMask:function(){var e,t,r=this,o=r._maskCtx,n=r.options,i=r._masks;if(i){var a=i.length;if(n.mask){if(r._clearCanvas(r._maskCtx),0==a)return;for(o.save(),o.globalCompositeOperation="source-over",o.fillStyle=n.maskColor,o.globalAlpha=n.maskOpacity,o.fillRect(0,0,o.canvas.width,o.canvas.height),o.globalCompositeOperation="destination-out",o.globalAlpha=1,e=0;e<a;e++)t=i[e],t._drawMask&&t._drawMask();o.restore()}}},_onResize:function(){var e=this;e._resizeCanvases(),e._updateDrawSize(),e._requestUpdate()},_clearCanvas:function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)},_clearGlCanvas:function(){var e=this,t=e._gl,r=G.Util.colorRgb(e.options.glColor);t.clearColor(r[0]/255,r[1]/255,r[2]/255,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},_resizeCanvas:function(e,t,r,o){var n=this,i=e.canvas,a=o?o[0]||1:1,_=o?o[1]||1:1,l=n.options.canvasExpandFactor,s=t*l,u=r*l,f=t+2*s,c=r+2*u;G.DomUtil.setPosition(i,-s,-u),1==a&&1==_?(i.width=f,i.height=c,i.style.width="",i.style.height="",e.scale(1,1)):(i.width=f*a,i.height=c*_,i.style.width=f+"px",i.style.height=c+"px",e.scale(a,_))},_resizeGlCanvas:function(){var e=this,t=e._gl,r=t.canvas,o=G.Browser.getCanvasRatio(),n=o?o[0]||1:1,i=o?o[1]||1:1,a=e.getSize(),_=a[0],l=a[1],s=_/2,u=l/2,f=e.options.canvasExpandFactor,c=_*f,g=l*f,h=_+2*c,p=l+2*g;G.DomUtil.setPosition(r,-c,-g),e._canvasOffset=[c,g];var d=e._camera,v=d?d.near:void 0,m=d?d.far:void 0,x=e._camera=new G.GLOrthoCamera(-s-c,s+c,-u-g,u+g,v,m);x.moveTo(s+c,-u-g,x.far/2),x.lookAt(s+c,-u-g,0),1==n&&1==i?(r.width=h,r.height=p,r.style.width="",r.style.height="",e._canvasScale=[1,1]):(r.width=h*n,r.height=p*i,r.style.width=h+"px",r.style.height=p+"px",e._canvasScale=[n,i]),_=r.width,l=r.height,t.viewport(0,0,_,l)},_resizeCanvases:function(){var e=this,t=e.getSize(),r=t[0],o=t[1],n=G.Browser.getCanvasRatio(),i=(n?n[0]||1:1,n?n[1]||1:1,e.options.canvasExpandFactor),a=r*i,_=o*i;e._canvasOffset=[a,_],e._resizeCanvas(e._onScreenCtx,r,o,n),e._resizeCanvas(e._snapshotCtx,r,o,n),e._resizeCanvas(e._maskCtx,r,o,[1,1]),e._resizeGlCanvas()},_onZoomStart:function(e){this._snapshotCanvas()},_onRotateStart:function(e){this._snapshotCanvas()},_onPinchStart:function(e){this._snapshotCanvas()},_snapshotCanvas:function(){var e=this;if(!e.options.canvasAnimRedraw){var t=e._onScreenCtx.canvas,r=G.Browser.getCanvasRatio(),o=t.width/(r[0]||1),n=t.height/(r[1]||1);e._clearCanvas(e._snapshotCtx),e._snapshotCtx.drawImage(t,0,0,o,n)}},_calcCanvasOffset:function(){var e=this,t=e.getSize(),r=e.getDrawSize(),o=r[0],n=r[1],i=(t[0]-o)/2,a=(t[1]-n)/2;return[i,a]},_beforeMergeFramePos:function(){var e=this,t=e._mapFrame,r=G.DomUtil.getPosition(t),o=r[0],n=r[1];try{e._onScreenCtx.drawImage(e._onScreenCtx.canvas,o,n)}catch(i){}}});