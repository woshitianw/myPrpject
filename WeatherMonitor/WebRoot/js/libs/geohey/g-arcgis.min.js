G.ArcGISUtil={toGraphics:function(e,r){var o,t,i=e.attributes,n=[];if("esriGeometryPoint"==r){var a=e.geometry;o=G.Util.isArray(a)?a:[a.x,a.y],n.push(new G.Graphic.Point(o,i))}else if("esriGeometryPolyline"==r){var s=e.geometry.paths;for(t in s)o=s[t],n.push(new G.Graphic.Polyline(o,i))}else if("esriGeometryPolygon"==r){var p,l=e.geometry.rings;o=[];for(t in l)p=l[t],p.splice(p.length-1),o.push(p);n.push(new G.Graphic.Polygon(o,i))}return n}},G.Layer.ArcGISFeature=G.Layer.FeatureService.extend({options:{mode:"tile",maxHandle:1e3,fields:"*",where:"1=1"},init:function(e,r){var o=this,t=function(r){var t=e+"/query",i={f:"json",where:o.options.where,outFields:o.options.fields,inSR:o._map?o._map.options.srid:"",outSR:o._map?o._map.options.srid:""};"tile"==o.options.mode&&(i.geometryType="esriGeometryEnvelope",i.geometry=r[0]+","+r[1]+","+r[2]+","+r[3]);var n={responseType:"http"===t.slice(0,4).toLowerCase()?"JSONP":"JSON",data:i,success:function(e,t){var i=t.geometryType,n=t.objectIdFieldName,a=t.features;if(a){var s,p,l,c,y,m,u,f=a.length-1,h=Math.max(0,f-o.options.maxHandle);for(s=f;s>=h;s--){p=a[s],l=p.attributes||{},y=G.ArcGISUtil.toGraphics(p,i);for(m in y)u=y[m],u&&(c=l[n]+"_"+m,o.get(c)||u.addTo(o,c))}o.onSuccess(r)}},error:function(){o.onError(r)},complete:function(){o.onComplete(r)}};G.Util.ajax(t,n)};G.Layer.FeatureService.prototype.init.call(o,t,r)}});